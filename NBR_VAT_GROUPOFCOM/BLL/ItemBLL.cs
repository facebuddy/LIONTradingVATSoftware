using System;
using System.Data;
using System.Web;
using System.Web.SessionState;
namespace NBR_VAT_GROUPOFCOM.BLL
{

    public class ItemBLL
    {
        private DBUtility DBUtil = new DBUtility();

        public ItemBLL()
        {
        }

        public DataTable challanNoforIssue()
        {
            string str = HttpContext.Current.Session["ORGANIZATION_ID"].ToString();
            string str1 = string.Concat("  select tpm.challan_no,i.item_name,TO_CHAR(tpm.date_challan,'dd/MM/yyyy') date_challan,tp.party_name,case when tpd.vds_amount = 0 then tpd.purchase_vat else tpd.vds_amount end  vds_amount\r\n                        from trns_purchase_master as tpm\r\n                        inner join trns_purchase_detail as tpd on tpm.challan_id = tpd.challan_id \r\n                        inner join item as i on i.item_id = tpd.item_id\r\n                        inner join trns_party tp  on tp.party_id = tpm.party_id\r\n                        left join trns_treasury_challan ttc on tpm.challan_no = ttc.challan_numbers\r\n                        where tpm.is_payment_finished=true and is_vat_paid=true and tpm.organization_id = ", str, " and tpd.is_source_tax_deduct = true and tpd.is_deleted = false AND tpd.vds_status = false   and tpm.vds_cert_issued_no is null\r\n                        group by tpd.purchase_vat,tpd.vds_amount,tpm.challan_no,i.item_name,tpm.date_challan,tp.party_name");
            return this.DBUtil.GetDataTable(str1);
        }

        public DataTable challanNoforTransfer()
        {
            string str = HttpContext.Current.Session["ORGANIZATION_ID"].ToString();
            string str1 = HttpContext.Current.Session["ORGBRANCHID"].ToString();
            string[] strArrays = new string[] { "  select distinct tpm.challan_no,i.item_name,TO_CHAR(tpm.issues_date,'dd/MM/yyyy') date_challan,obri.branch_unit_name\r\n                        from trns_transfer_master tpm\r\n                        inner join trns_transfer_detail tpd on tpm.transfer_id=tpd.transfer_id \r\n                        inner join item as i on i.item_id = tpd.item_id\r\n                        inner join org_branch_reg_info as obri on obri.org_branch_reg_id = tpm.issuing_branch_id\r\n                        where  tpm.organization_id = ", str, "  and tpm.receiving_branch_id=", str1, " and transfer_status='I'" };
            string str2 = string.Concat(strArrays);
            return this.DBUtil.GetDataTable(str2);
        }

        public DataTable ChartPurchaseForAdmin()
        {
            return this.DBUtil.GetDataTable("select * from \r\n            (\r\n\t        SELECT to_char(current_date,'MON-yyyy') Date,\r\n\t        cast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n            cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A\r\n            WHERE to_char(date_insert,'mm') = to_char(current_date - INTERVAL '0 months','mm' )  AND is_deleted = false\r\n\r\n\tUNION ALL \r\n\r\n\t\tSELECT to_char(current_date - INTERVAL '1 months','MON-yyyy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A\r\n            WHERE to_char(date_insert,'mm') = to_char(current_date - INTERVAL '1 months','mm' )  AND is_deleted = false\r\n\r\n\r\n\tUNION ALL \r\n\r\n\t\tSELECT to_char(current_date - INTERVAL '2 months','MON-yyyy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A\r\n            WHERE to_char(date_insert,'mm') = to_char(current_date - INTERVAL '2 months','mm' )  AND is_deleted = false\r\n\r\n\r\n\tUNION ALL \r\n\r\n\t\tSELECT to_char(current_date - INTERVAL '3 months','MON-yyyy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A\r\n            WHERE to_char(date_insert,'mm') = to_char(current_date - INTERVAL '3 months','mm' )  AND is_deleted = false\r\n\r\n\r\n\tUNION ALL \r\n\r\n\tSELECT to_char(current_date - INTERVAL '4 months','MON-yyyy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A\r\n            WHERE to_char(date_insert,'mm') = to_char(current_date - INTERVAL '4 months','mm' )  AND is_deleted = false\r\n\r\n\r\n\tUNION ALL \r\n\r\n\tSELECT to_char(current_date - INTERVAL '5 months','MON-yyyy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A\r\n            WHERE to_char(date_insert,'mm') = to_char(current_date - INTERVAL '5 months','mm' )  AND is_deleted = false\r\n\r\n\r\n\tUNION ALL \r\n\r\n\tSELECT to_char(current_date - INTERVAL '6 months','MON-yyyy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A\r\n            WHERE to_char(date_insert,'mm') = to_char(current_date - INTERVAL '6 months','mm' )  AND is_deleted = false\r\n\r\n\r\n\tUNION ALL \r\n\r\n\tSELECT to_char(current_date - INTERVAL '7 months','MON-yyyy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A\r\n            WHERE to_char(date_insert,'mm') = to_char(current_date - INTERVAL '7 months','mm' )  AND is_deleted = false\r\n\r\n\r\n\tUNION ALL \r\n\r\n\tSELECT to_char(current_date - INTERVAL '8 months','MON-yyyy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A\r\n            WHERE to_char(date_insert,'mm') = to_char(current_date - INTERVAL '8 months','mm' )  AND is_deleted = false\r\n\r\n\r\n\tUNION ALL \r\n\r\n\tSELECT to_char(current_date - INTERVAL '9 months','MON-yyyy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A\r\n            WHERE to_char(date_insert,'mm') = to_char(current_date - INTERVAL '9 months','mm' )  AND is_deleted = false\r\n\r\n\r\n\tUNION ALL \r\n\r\n\tSELECT to_char(current_date - INTERVAL '10 months' ,'MON-yyyy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A\r\n            WHERE to_char(date_insert,'mm') = to_char(current_date - INTERVAL '10 months','mm' )  AND is_deleted = false\r\n\r\n\r\n\tUNION ALL \r\n\r\n\r\n\t\tSELECT to_char(current_date - INTERVAL '11 months','MON-yyyy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A\r\n            WHERE to_char(date_insert,'mm') = to_char(current_date - INTERVAL '11 months','mm' )  AND is_deleted = false\r\n\r\n            )B\r\n            ORDER BY to_date(Date, 'Mon-YYYY')\r\n        ");
        }

        public DataTable ChartPurchaseForManager()
        {
            return this.DBUtil.GetDataTable("select * from (\r\n\tSELECT to_char(current_date,'dd-MON-yy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A \r\n            WHERE date_insert BETWEEN (current_date + Time '12:01 AM') AND (current_date + Time '11:59 pm') AND is_deleted = false\r\n            \r\n\r\n            union ALL\r\n\r\n            SELECT to_char((current_date - INTERVAL '1 day'),'dd-MON-yy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A \r\n            WHERE date_insert BETWEEN ((current_date - INTERVAL '1 day') + Time '12:01 AM') AND ((current_date - INTERVAL '1 day') + Time '11:59 pm') AND is_deleted = false            \r\n            \r\n\r\n            union ALL\r\n            \r\n           SELECT to_char((current_date - INTERVAL '2 day'),'dd-MON-yy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A \r\n            WHERE date_insert BETWEEN ((current_date - INTERVAL '2 day') + Time '12:01 AM') AND ((current_date - INTERVAL '2 day') + Time '11:59 pm') AND is_deleted = false            \r\n            \r\n\r\n\t    union all\r\n\r\n\t    SELECT to_char((current_date - INTERVAL '3 day'),'dd-MON-yy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A \r\n            WHERE date_insert BETWEEN ((current_date - INTERVAL '3 day') + Time '12:01 AM') AND ((current_date - INTERVAL '3 day') + Time '11:59 pm') AND is_deleted = false            \r\n            \r\n\r\n            union all\r\n\r\n\t     SELECT to_char((current_date - INTERVAL '4 day'),'dd-MON-yy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A \r\n            WHERE date_insert BETWEEN ((current_date - INTERVAL '4 day') + Time '12:01 AM') AND ((current_date - INTERVAL '4 day') + Time '11:59 pm') AND is_deleted = false            \r\n            \r\n\r\n            union all\r\n\r\n             SELECT to_char((current_date - INTERVAL '5 day'),'dd-MON-yy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A \r\n            WHERE date_insert BETWEEN ((current_date - INTERVAL '5 day') + Time '12:01 AM') AND ((current_date - INTERVAL '5 day') + Time '11:59 pm') AND is_deleted = false            \r\n            \r\n\r\n            union all\r\n\r\n\tSELECT to_char((current_date - INTERVAL '6 day'),'dd-MON-yy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A \r\n            WHERE date_insert BETWEEN ((current_date - INTERVAL '6 day') + Time '12:01 AM') AND ((current_date - INTERVAL '6 day') + Time '11:59 pm') AND is_deleted = false            \r\n            \r\n\r\n            union all\r\n\r\n            \r\n\tSELECT to_char((current_date - INTERVAL '7 day'),'dd-MON-yy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A \r\n            WHERE date_insert BETWEEN ((current_date - INTERVAL '7 day') + Time '12:01 AM') AND ((current_date - INTERVAL '7 day') + Time '11:59 pm') AND is_deleted = false            \r\n            \r\n\r\n            union all\r\n\r\n\r\n            SELECT to_char((current_date - INTERVAL '8 day'),'dd-MON-yy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A \r\n            WHERE date_insert BETWEEN ((current_date - INTERVAL '8 day') + Time '12:01 AM') AND ((current_date - INTERVAL '8 day') + Time '11:59 pm') AND is_deleted = false            \r\n            \r\n\r\n            union all\r\n\r\n            SELECT to_char((current_date - INTERVAL '9 day'),'dd-MON-yy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A \r\n            WHERE date_insert BETWEEN ((current_date - INTERVAL '9 day') + Time '12:01 AM') AND ((current_date - INTERVAL '9 day') + Time '11:59 pm') AND is_deleted = false            \r\n            \r\n------------------------------------------------------------------------------\r\n            union all\r\n\r\n            SELECT to_char((current_date - INTERVAL '10 day'),'dd-MON-yy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A \r\n            WHERE date_insert BETWEEN ((current_date - INTERVAL '10 day') + Time '12:01 AM') AND ((current_date - INTERVAL '10 day') + Time '11:59 pm') AND is_deleted = false            \r\n            \r\n\r\n            union all\r\n\r\n            \tSELECT to_char((current_date - INTERVAL '11 day'),'dd-MON-yy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A \r\n            WHERE date_insert BETWEEN ((current_date - INTERVAL '11 day') + Time '12:01 AM') AND ((current_date - INTERVAL '11 day') + Time '11:59 pm') AND is_deleted = false            \r\n            \r\n\r\n            union all\r\n\r\n\tSELECT to_char((current_date - INTERVAL '12 day'),'dd-MON-yy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A \r\n            WHERE date_insert BETWEEN ((current_date - INTERVAL '12 day') + Time '12:01 AM') AND ((current_date - INTERVAL '12 day') + Time '11:59 pm') AND is_deleted = false            \r\n            \r\n\r\n            union all\r\n\r\n\tSELECT to_char((current_date - INTERVAL '13 day'),'dd-MON-yy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A \r\n            WHERE date_insert BETWEEN ((current_date - INTERVAL '13 day') + Time '12:01 AM') AND ((current_date - INTERVAL '13 day') + Time '11:59 pm') AND is_deleted = false            \r\n            \r\n\r\n            union all\r\n\r\n\tSELECT to_char((current_date - INTERVAL '14 day'),'dd-MON-yy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A \r\n            WHERE date_insert BETWEEN ((current_date - INTERVAL '14 day') + Time '12:01 AM') AND ((current_date - INTERVAL '14 day') + Time '11:59 pm') AND is_deleted = false            \r\n            \r\n\r\n            union all\r\n\r\n\tSELECT to_char((current_date - INTERVAL '15 day'),'dd-MON-yy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A \r\n            WHERE date_insert BETWEEN ((current_date - INTERVAL '15 day') + Time '12:01 AM') AND ((current_date - INTERVAL '15 day') + Time '11:59 pm') AND is_deleted = false            \r\n            \r\n\r\n            union all\r\n\r\n            SELECT to_char((current_date - INTERVAL '16 day'),'dd-MON-yy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A \r\n            WHERE date_insert BETWEEN ((current_date - INTERVAL '16 day') + Time '12:01 AM') AND ((current_date - INTERVAL '16 day') + Time '11:59 pm') AND is_deleted = false            \r\n            \r\n\r\n            union all\r\n\r\n            SELECT to_char((current_date - INTERVAL '17 day'),'dd-MON-yy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A \r\n            WHERE date_insert BETWEEN ((current_date - INTERVAL '17 day') + Time '12:01 AM') AND ((current_date - INTERVAL '17 day') + Time '11:59 pm') AND is_deleted = false            \r\n            \r\n\r\n            union all\r\n\r\n            SELECT to_char((current_date - INTERVAL '18 day'),'dd-MON-yy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A \r\n            WHERE date_insert BETWEEN ((current_date - INTERVAL '18 day') + Time '12:01 AM') AND ((current_date - INTERVAL '18 day') + Time '11:59 pm') AND is_deleted = false            \r\n            \r\n\r\n            union all\r\n            \r\n\r\n\tSELECT to_char((current_date - INTERVAL '19 day'),'dd-MON-yy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A \r\n            WHERE date_insert BETWEEN ((current_date - INTERVAL '19 day') + Time '12:01 AM') AND ((current_date - INTERVAL '19 day') + Time '11:59 pm') AND is_deleted = false            \r\n            \r\n\r\n            union all\r\n\r\n\tSELECT to_char((current_date - INTERVAL '20 day'),'dd-MON-yy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A \r\n            WHERE date_insert BETWEEN ((current_date - INTERVAL '20 day') + Time '12:01 AM') AND ((current_date - INTERVAL '20 day') + Time '11:59 pm') AND is_deleted = false            \r\n            \r\n\r\n            union all\r\n\r\n\tSELECT to_char((current_date - INTERVAL '21 day'),'dd-MON-yy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A \r\n            WHERE date_insert BETWEEN ((current_date - INTERVAL '21 day') + Time '12:01 AM') AND ((current_date - INTERVAL '21 day') + Time '11:59 pm') AND is_deleted = false            \r\n            \r\n\r\n            union all\r\n\r\n            SELECT to_char((current_date - INTERVAL '22 day'),'dd-MON-yy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A \r\n            WHERE date_insert BETWEEN ((current_date - INTERVAL '22 day') + Time '12:01 AM') AND ((current_date - INTERVAL '22 day') + Time '11:59 pm') AND is_deleted = false            \r\n            \r\n\r\n            union all\r\n\r\n            SELECT to_char((current_date - INTERVAL '23 day'),'dd-MON-yy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A \r\n            WHERE date_insert BETWEEN ((current_date - INTERVAL '23 day') + Time '12:01 AM') AND ((current_date - INTERVAL '23 day') + Time '11:59 pm') AND is_deleted = false            \r\n            \r\n\r\n            union all\r\n\r\n            SELECT to_char((current_date - INTERVAL '24 day'),'dd-MON-yy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A \r\n            WHERE date_insert BETWEEN ((current_date - INTERVAL '24 day') + Time '12:01 AM') AND ((current_date - INTERVAL '24 day') + Time '11:59 pm') AND is_deleted = false            \r\n            \r\n\r\n            union all\r\n\r\n            SELECT to_char((current_date - INTERVAL '25 day'),'dd-MON-yy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A  \r\n            WHERE date_insert BETWEEN ((current_date - INTERVAL '25 day') + Time '12:01 AM') AND ((current_date - INTERVAL '25 day') + Time '11:59 pm') AND is_deleted = false            \r\n            \r\n\r\n            union all\r\n\t\tSELECT to_char((current_date - INTERVAL '26 day'),'dd-MON-yy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A \r\n            WHERE date_insert BETWEEN ((current_date - INTERVAL '26 day') + Time '12:01 AM') AND ((current_date - INTERVAL '26 day') + Time '11:59 pm') AND is_deleted = false            \r\n            \r\n\r\n            union all\r\n\r\n            SELECT to_char((current_date - INTERVAL '27 day'),'dd-MON-yy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A \r\n            WHERE date_insert BETWEEN ((current_date - INTERVAL '27 day') + Time '12:01 AM') AND ((current_date - INTERVAL '27 day') + Time '11:59 pm') AND is_deleted = false            \r\n            \r\n\r\n            union all\r\n\r\n            SELECT to_char((current_date - INTERVAL '28 day'),'dd-MON-yy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A \r\n            WHERE date_insert BETWEEN ((current_date - INTERVAL '28 day') + Time '12:01 AM') AND ((current_date - INTERVAL '28 day') + Time '11:59 pm') AND is_deleted = false            \r\n            \r\n\r\n            union all\r\n\r\n            \tSELECT to_char((current_date - INTERVAL '29 day'),'dd-MON-yy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A \r\n            WHERE date_insert BETWEEN ((current_date - INTERVAL '29 day') + Time '12:01 AM') AND ((current_date - INTERVAL '29 day') + Time '11:59 pm') AND is_deleted = false            \r\n            \r\n\r\n            union all\r\n\r\n\r\n            \tSELECT to_char((current_date - INTERVAL '30 day'),'dd-MON-yy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A \r\n            WHERE date_insert BETWEEN ((current_date - INTERVAL '30 day') + Time '12:01 AM') AND ((current_date - INTERVAL '30 day') + Time '11:59 pm') AND is_deleted = false \r\n            )A\r\n            ORDER BY to_date(Date, 'DD Mon YYYY')");
        }

        public DataTable ChartPurchaseForNormalUser(int user_id)
        {
            string str = string.Concat("select * from (\r\n\tSELECT to_char(current_date,'dd-MON-yy') Date,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n            cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A \r\n             WHERE date_insert BETWEEN (current_date + Time '12:01 AM') AND (current_date + Time '11:59 pm') AND is_deleted = false AND User_id_insert = ", user_id, " )B  ORDER BY to_date(Date, 'DD Mon YYYY')");
            return this.DBUtil.GetDataTable(str);
        }

        public DataTable ChartSaleForAdmin()
        {
            return this.DBUtil.GetDataTable("select * from ( SELECT to_char(current_date,'MON-yyyy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE to_char(date_insert,'mm') = to_char(current_date - INTERVAL '0 months','mm' )  AND is_deleted = false\r\n        \r\n\r\n\r\nUNION ALL\r\n\r\n\r\n\t\r\n\tSELECT to_char(current_date - INTERVAL '1 months','MON-yyyy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE to_char(date_insert,'mm') = to_char(current_date - INTERVAL '1 months','mm' )  AND is_deleted = false\r\n\r\nUNION ALL\t\r\n\r\n\r\nSELECT to_char(current_date - INTERVAL '2 months','MON-yyyy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE to_char(date_insert,'mm') = to_char(current_date - INTERVAL '2 months','mm' )  AND is_deleted = false\r\n\r\nUNION ALL\t\r\n\r\n\r\nSELECT to_char(current_date - INTERVAL '3 months','MON-yyyy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE to_char(date_insert,'mm') = to_char(current_date - INTERVAL '3 months','mm' )  AND is_deleted = false\r\n\r\nUNION ALL\t\r\n\r\nSELECT to_char(current_date - INTERVAL '4 months','MON-yyyy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE to_char(date_insert,'mm') = to_char(current_date - INTERVAL '4 months','mm' )  AND is_deleted = false\r\n\r\nUNION ALL\t\r\n\r\n\r\nSELECT to_char(current_date - INTERVAL '5 months','MON-yyyy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE to_char(date_insert,'mm') = to_char(current_date - INTERVAL '5 months','mm' )  AND is_deleted = false\r\n\r\nUNION ALL\t\r\n\r\n\r\nSELECT to_char(current_date - INTERVAL '6 months','MON-yyyy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE to_char(date_insert,'mm') = to_char(current_date - INTERVAL '6 months','mm' )  AND is_deleted = false\r\n\r\nUNION ALL\t\r\n\r\n\r\nSELECT to_char(current_date - INTERVAL '7 months','MON-yyyy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE to_char(date_insert,'mm') = to_char(current_date - INTERVAL '7 months','mm' )  AND is_deleted = false\r\n\r\nUNION ALL\t\r\n\r\n\r\nSELECT to_char(current_date - INTERVAL '8 months','MON-yyyy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE to_char(date_insert,'mm') = to_char(current_date - INTERVAL '8 months','mm' )  AND is_deleted = false\r\n\r\nUNION ALL\t\r\n\r\n\r\nSELECT to_char(current_date - INTERVAL '9 months','MON-yyyy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE to_char(date_insert,'mm') = to_char(current_date - INTERVAL '9 months','mm' )  AND is_deleted = false\r\n\r\nUNION ALL\t\r\n\r\n\r\nSELECT to_char(current_date - INTERVAL '10 months','MON-yyyy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE to_char(date_insert,'mm') = to_char(current_date - INTERVAL '10 months','mm' )  AND is_deleted = false\r\n\r\nUNION ALL\t\r\n\r\n\r\nSELECT to_char(current_date - INTERVAL '11 months','MON-yyyy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE to_char(date_insert,'mm') = to_char(current_date - INTERVAL '11 months','mm' )  AND is_deleted = false\r\n       )B\r\n\r\nORDER BY to_date(Date, 'Mon-YYYY')\r\n");
        }

        public DataTable ChartSaleForManager()
        {
            return this.DBUtil.GetDataTable("select * from ( SELECT to_char(current_date,'dd-MON-yy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE date_insert BETWEEN (current_date + Time '12:01 AM') AND (current_date + Time '11:59 pm') AND is_deleted = false AND User_id_insert IN (select employee_id from admn_employee WHERE user_level <> 1)\r\n\r\n\tUNION ALL\r\n\r\n        SELECT to_char((current_date - INTERVAL '1 day'),'dd-MON-yy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n         WHERE date_insert BETWEEN ((current_date - INTERVAL '1 day') + Time '12:01 AM') AND ((current_date - INTERVAL '1 day') + Time '11:59 pm')  \r\n         AND is_deleted = false AND User_id_insert IN (select employee_id from admn_employee WHERE user_level <> 1)\r\n\r\n\tUNION ALL\r\n\r\n        SELECT to_char((current_date - INTERVAL '2 day'),'dd-MON-yy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n         WHERE date_insert BETWEEN ((current_date - INTERVAL '2 day') + Time '12:01 AM') AND ((current_date - INTERVAL '2 day') + Time '11:59 pm')  \r\n         AND is_deleted = false AND User_id_insert IN (select employee_id from admn_employee WHERE user_level <> 1)\r\n\r\n\tUNION ALL\r\n\t\r\n        SELECT to_char((current_date - INTERVAL '3 day'),'dd-MON-yy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n         WHERE date_insert BETWEEN ((current_date - INTERVAL '3 day') + Time '12:01 AM') AND ((current_date - INTERVAL '3 day') + Time '11:59 pm')  \r\n         AND is_deleted = false AND User_id_insert IN (select employee_id from admn_employee WHERE user_level <> 1)\r\n\r\n\tUNION ALL\r\n\r\n\tSELECT to_char((current_date - INTERVAL '4 day'),'dd-MON-yy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n         WHERE date_insert BETWEEN ((current_date - INTERVAL '4 day') + Time '12:01 AM') AND ((current_date - INTERVAL '4 day') + Time '11:59 pm')  \r\n         AND is_deleted = false AND User_id_insert IN (select employee_id from admn_employee WHERE user_level <> 1)\r\n\r\n\tUNION ALL\r\n\r\nSELECT to_char((current_date - INTERVAL '5 day'),'dd-MON-yy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n         WHERE date_insert BETWEEN ((current_date - INTERVAL '5 day') + Time '12:01 AM') AND ((current_date - INTERVAL '5 day') + Time '11:59 pm')  \r\n         AND is_deleted = false AND User_id_insert IN (select employee_id from admn_employee WHERE user_level <> 1)\r\n\r\n\tUNION ALL\r\n\r\n\tSELECT to_char((current_date - INTERVAL '6 day'),'dd-MON-yy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n         WHERE date_insert BETWEEN ((current_date - INTERVAL '6 day') + Time '12:01 AM') AND ((current_date - INTERVAL '6 day') + Time '11:59 pm')  \r\n         AND is_deleted = false AND User_id_insert IN (select employee_id from admn_employee WHERE user_level <> 1)\r\n\r\n\tUNION ALL\r\n\r\n\tSELECT to_char((current_date - INTERVAL '7 day'),'dd-MON-yy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n         WHERE date_insert BETWEEN ((current_date - INTERVAL '7 day') + Time '12:01 AM') AND ((current_date - INTERVAL '7 day') + Time '11:59 pm')  \r\n         AND is_deleted = false AND User_id_insert IN (select employee_id from admn_employee WHERE user_level <> 1)\r\n\r\n\tUNION ALL\r\n\r\n\tSELECT to_char((current_date - INTERVAL '8 day'),'dd-MON-yy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n         WHERE date_insert BETWEEN ((current_date - INTERVAL '8 day') + Time '12:01 AM') AND ((current_date - INTERVAL '8 day') + Time '11:59 pm')  \r\n         AND is_deleted = false AND User_id_insert IN (select employee_id from admn_employee WHERE user_level <> 1)\r\n\r\n\tUNION ALL\r\n\r\n\tSELECT to_char((current_date - INTERVAL '9 day'),'dd-MON-yy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n         WHERE date_insert BETWEEN ((current_date - INTERVAL '9 day') + Time '12:01 AM') AND ((current_date - INTERVAL '9 day') + Time '11:59 pm')  \r\n         AND is_deleted = false AND User_id_insert IN (select employee_id from admn_employee WHERE user_level <> 1)\r\n\r\n\tUNION ALL\r\n\r\n\tSELECT to_char((current_date - INTERVAL '10 day'),'dd-MON-yy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n         WHERE date_insert BETWEEN ((current_date - INTERVAL '10 day') + Time '12:01 AM') AND ((current_date - INTERVAL '10 day') + Time '11:59 pm')  \r\n         AND is_deleted = false AND User_id_insert IN (select employee_id from admn_employee WHERE user_level <> 1)\r\n\r\n\tUNION ALL\r\n\r\n\tSELECT to_char((current_date - INTERVAL '11 day'),'dd-MON-yy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n         WHERE date_insert BETWEEN ((current_date - INTERVAL '11 day') + Time '12:01 AM') AND ((current_date - INTERVAL '11 day') + Time '11:59 pm')  \r\n         AND is_deleted = false AND User_id_insert IN (select employee_id from admn_employee WHERE user_level <> 1)\r\n\r\n\tUNION ALL\r\n\r\n\tSELECT to_char((current_date - INTERVAL '12 day'),'dd-MON-yy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n         WHERE date_insert BETWEEN ((current_date - INTERVAL '12 day') + Time '12:01 AM') AND ((current_date - INTERVAL '12 day') + Time '11:59 pm')  \r\n         AND is_deleted = false AND User_id_insert IN (select employee_id from admn_employee WHERE user_level <> 1)\r\n\r\n\tUNION ALL\r\n\r\nSELECT to_char((current_date - INTERVAL '13 day'),'dd-MON-yy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n         WHERE date_insert BETWEEN ((current_date - INTERVAL '13 day') + Time '12:01 AM') AND ((current_date - INTERVAL '13 day') + Time '11:59 pm')  \r\n         AND is_deleted = false AND User_id_insert IN (select employee_id from admn_employee WHERE user_level <> 1)\r\n\r\n\tUNION ALL\r\n\r\n\tSELECT to_char((current_date - INTERVAL '14 day'),'dd-MON-yy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n         WHERE date_insert BETWEEN ((current_date - INTERVAL '14 day') + Time '12:01 AM') AND ((current_date - INTERVAL '14 day') + Time '11:59 pm')  \r\n         AND is_deleted = false AND User_id_insert IN (select employee_id from admn_employee WHERE user_level <> 1)\r\n\r\n\tUNION ALL\r\n\r\n\tSELECT to_char((current_date - INTERVAL '15 day'),'dd-MON-yy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n         WHERE date_insert BETWEEN ((current_date - INTERVAL '15 day') + Time '12:01 AM') AND ((current_date - INTERVAL '15 day') + Time '11:59 pm')  \r\n         AND is_deleted = false AND User_id_insert IN (select employee_id from admn_employee WHERE user_level <> 1)\r\n\r\n\tUNION ALL\r\n\r\nSELECT to_char((current_date - INTERVAL '16 day'),'dd-MON-yy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n         WHERE date_insert BETWEEN ((current_date - INTERVAL '16 day') + Time '12:01 AM') AND ((current_date - INTERVAL '16 day') + Time '11:59 pm')  \r\n         AND is_deleted = false AND User_id_insert IN (select employee_id from admn_employee WHERE user_level <> 1)\r\n\r\n\tUNION ALL\r\n\r\nSELECT to_char((current_date - INTERVAL '17 day'),'dd-MON-yy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n         WHERE date_insert BETWEEN ((current_date - INTERVAL '17 day') + Time '12:01 AM') AND ((current_date - INTERVAL '17 day') + Time '11:59 pm')  \r\n         AND is_deleted = false AND User_id_insert IN (select employee_id from admn_employee WHERE user_level <> 1)\r\n\r\n\tUNION ALL\r\n\r\nSELECT to_char((current_date - INTERVAL '18 day'),'dd-MON-yy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n         WHERE date_insert BETWEEN ((current_date - INTERVAL '18 day') + Time '12:01 AM') AND ((current_date - INTERVAL '18 day') + Time '11:59 pm')  \r\n         AND is_deleted = false AND User_id_insert IN (select employee_id from admn_employee WHERE user_level <> 1)\r\n\r\n\tUNION ALL\r\n\r\n\tSELECT to_char((current_date - INTERVAL '19 day'),'dd-MON-yy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n         WHERE date_insert BETWEEN ((current_date - INTERVAL '19 day') + Time '12:01 AM') AND ((current_date - INTERVAL '19 day') + Time '11:59 pm')  \r\n         AND is_deleted = false AND User_id_insert IN (select employee_id from admn_employee WHERE user_level <> 1)\r\n\r\n\tUNION ALL\r\n\r\nSELECT to_char((current_date - INTERVAL '20 day'),'dd-MON-yy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n         WHERE date_insert BETWEEN ((current_date - INTERVAL '20 day') + Time '12:01 AM') AND ((current_date - INTERVAL '20 day') + Time '11:59 pm')  \r\n         AND is_deleted = false AND User_id_insert IN (select employee_id from admn_employee WHERE user_level <> 1)\r\n\r\n\tUNION ALL\r\n\r\nSELECT to_char((current_date - INTERVAL '21 day'),'dd-MON-yy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n         WHERE date_insert BETWEEN ((current_date - INTERVAL '21 day') + Time '12:01 AM') AND ((current_date - INTERVAL '21 day') + Time '11:59 pm')  \r\n         AND is_deleted = false AND User_id_insert IN (select employee_id from admn_employee WHERE user_level <> 1)\r\n\r\n\tUNION ALL\r\n\r\nSELECT to_char((current_date - INTERVAL '22 day'),'dd-MON-yy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n         WHERE date_insert BETWEEN ((current_date - INTERVAL '22 day') + Time '12:01 AM') AND ((current_date - INTERVAL '22 day') + Time '11:59 pm')  \r\n         AND is_deleted = false AND User_id_insert IN (select employee_id from admn_employee WHERE user_level <> 1)\r\n\r\n\tUNION ALL\r\n\r\nSELECT to_char((current_date - INTERVAL '23 day'),'dd-MON-yy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n         WHERE date_insert BETWEEN ((current_date - INTERVAL '23 day') + Time '12:01 AM') AND ((current_date - INTERVAL '24 day') + Time '11:59 pm')  \r\n         AND is_deleted = false AND User_id_insert IN (select employee_id from admn_employee WHERE user_level <> 1)\r\n\r\n\tUNION ALL\r\n\r\n\tSELECT to_char((current_date - INTERVAL '25 day'),'dd-MON-yy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n         WHERE date_insert BETWEEN ((current_date - INTERVAL '25 day') + Time '12:01 AM') AND ((current_date - INTERVAL '25 day') + Time '11:59 pm')  \r\n         AND is_deleted = false AND User_id_insert IN (select employee_id from admn_employee WHERE user_level <> 1)\r\n\r\n\tUNION ALL\r\n\r\nSELECT to_char((current_date - INTERVAL '26 day'),'dd-MON-yy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n         WHERE date_insert BETWEEN ((current_date - INTERVAL '26 day') + Time '12:01 AM') AND ((current_date - INTERVAL '26 day') + Time '11:59 pm')  \r\n         AND is_deleted = false AND User_id_insert IN (select employee_id from admn_employee WHERE user_level <> 1)\r\n\r\n\tUNION ALL\r\n\r\nSELECT to_char((current_date - INTERVAL '27 day'),'dd-MON-yy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n         WHERE date_insert BETWEEN ((current_date - INTERVAL '27 day') + Time '12:01 AM') AND ((current_date - INTERVAL '27 day') + Time '11:59 pm')  \r\n         AND is_deleted = false AND User_id_insert IN (select employee_id from admn_employee WHERE user_level <> 1)\r\n\r\n\tUNION ALL\r\n\r\nSELECT to_char((current_date - INTERVAL '28 day'),'dd-MON-yy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n         WHERE date_insert BETWEEN ((current_date - INTERVAL '28 day') + Time '12:01 AM') AND ((current_date - INTERVAL '28 day') + Time '11:59 pm')  \r\n         AND is_deleted = false AND User_id_insert IN (select employee_id from admn_employee WHERE user_level <> 1)\r\n\r\n\tUNION ALL\r\n\r\n\tSELECT to_char((current_date - INTERVAL '29 day'),'dd-MON-yy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n         WHERE date_insert BETWEEN ((current_date - INTERVAL '29 day') + Time '12:01 AM') AND ((current_date - INTERVAL '29 day') + Time '11:59 pm')  \r\n         AND is_deleted = false AND User_id_insert IN (select employee_id from admn_employee WHERE user_level <> 1)\r\n\r\n\tUNION ALL\r\n\r\n\tSELECT to_char((current_date - INTERVAL '30 day'),'dd-MON-yy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n         WHERE date_insert BETWEEN ((current_date - INTERVAL '30 day') + Time '12:01 AM') AND ((current_date - INTERVAL '30 day') + Time '11:59 pm')  \r\n         AND is_deleted = false AND User_id_insert IN (select employee_id from admn_employee WHERE user_level <> 1)\r\n            )A\r\n            ORDER BY to_date(Date, 'DD Mon YYYY')");
        }

        public DataTable ChartSaleForNormalUser(int user_id)
        {
            string str = string.Concat("select * from ( SELECT to_char(current_date,'dd-MON-yy') Date,coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE date_insert BETWEEN (current_date + Time '12:01 AM') AND (current_date + Time '11:59 pm') AND is_deleted = false AND User_id_insert =  ", user_id, " )B ORDER BY to_date(Date, 'DD Mon YYYY')");
            return this.DBUtil.GetDataTable(str);
        }

        public DataTable getAgreementByPartyId(int partyId)
        {
            int num = Convert.ToInt32(HttpContext.Current.Session["ORGANIZATION_ID"]);
            int num1 = Convert.ToInt32(HttpContext.Current.Session["ORGBRANCHID"]);
            object[] objArray = new object[] { " SELECT distinct isc.agreement_no,isc.party_id\r\n                                from installment_scheduler isc                               \r\n                                where isc.party_id=", partyId, " \r\n                                --AND isc.organization_id = ", num, " and isc.org_branch_reg_id=", num1, "\r\n                                 and is_paid=false" };
            string str = string.Concat(objArray);
            return this.DBUtil.GetDataTable(str);
        }

        public DataSet getAllItemName(int CategoryID)
        {
            string str;
            str = (CategoryID != 0 ? string.Concat("select  item_name ,Item_id from Item  where category_id='", CategoryID, "' AND Is_deleted=false") : "select  item_name ,Item_id from Item  where Is_deleted=false");
            return this.DBUtil.GetDataSet(str, "Item");
        }

        public DataSet getAllItemNameWithHashCode()
        {
            return this.DBUtil.GetDataSet("SELECT  item_name ,Item_id, item_name||' # '||hs_code items FROM Item WHERE Is_deleted=false", "Item");
        }

        public DataTable GetAllTaxRate(long itemID)
        {
            object[] objArray = new object[] { "  select item_name,   max(cd) CD,   max(rd) RD,  max(sd) SD, max(vat)  VAT,  max(ait) AIT, max(atv) ATV, max(tti) TTI , max(AT_) at_\r\n        from(\r\n            select i.item_name,itv.tax_value as CD, 0 as RD, 0 as SD, 0 as VAT, 0 as AIT, 0 ATV, 0 TTI,0 AT_\r\n            from item as i\r\n            left outer join item_tax_values as itv\r\n            on i.item_id = itv.item_id and tax_id = 1\r\n            where i.Is_deleted=false AND i.item_id = ", itemID, "\r\n\r\n            union all\r\n\r\n            select i.item_name, 0 as CD, itv.tax_value as RD, 0 as SD, 0 as VAT, 0 as AIT, 0 ATV, 0 TTI,0 AT_\r\n            from item as i\r\n            left outer join item_tax_values as itv\r\n            on i.item_id = itv.item_id and tax_id = 2\r\n            where i.Is_deleted=false AND i.item_id = ", itemID, "\r\n\r\n            union all\r\n\r\n            select i.item_name, 0 as CD, 0 as RD, itv.tax_value as SD, 0 as VAT, 0 as AIT, 0 ATV, 0 TTI,0 AT_\r\n            from item as i\r\n            left outer join item_tax_values as itv\r\n            on i.item_id = itv.item_id and tax_id = 3\r\n            where i.Is_deleted=false AND i.item_id = ", itemID, "\r\n\r\n            union all\r\n\r\n            select i.item_name, 0 as CD, 0 as RD, 0 as SD, itv.tax_value as VAT, 0 as AIT, 0 ATV, 0 TTI,0 AT_\r\n            from item as i\r\n            left outer join item_tax_values as itv\r\n            on i.item_id = itv.item_id and tax_id = 4\r\n            where i.Is_deleted=false AND i.item_id = ", itemID, "\r\n\r\n            union all\r\n\r\n            select i.item_name, 0 as CD, 0 as RD, 0 as SD, 0 as VAT, itv.tax_value as AIT, 0 ATV, 0 TTI,0 AT_\r\n            from item as i\r\n            left outer join item_tax_values as itv\r\n            on i.item_id = itv.item_id and tax_id = 5\r\n            where i.Is_deleted=false AND i.item_id = ", itemID, "\r\n\r\n            union all\r\n\r\n            select i.item_name, 0 as CD, 0 as RD, 0 as SD, 0 as VAT, 0 AIT, itv.tax_value as ATV, 0 TTI,0 AT_\r\n            from item as i\r\n            left outer join item_tax_values as itv\r\n            on i.item_id = itv.item_id and tax_id = 6\r\n            where i.Is_deleted=false AND i.item_id = ", itemID, "\r\n\r\n             union all\r\n\r\n            select i.item_name, 0 as CD, 0 as RD, 0 as SD, 0 as VAT, 0 AIT,0 ATV, itv.tax_value as TTI,0 AT_\r\n            from item as i\r\n            left outer join item_tax_values as itv\r\n            on i.item_id = itv.item_id and tax_id = 7\r\n            where i.Is_deleted=false AND i.item_id = ", itemID, "\r\n\r\n            union all\r\n\r\n            select i.item_name, 0 as CD, 0 as RD, 0 as SD, 0 as VAT, 0 AIT,0 ATV, 0 TTI, itv.tax_value as AT_\r\n            from item as i\r\n            left outer join item_tax_values as itv\r\n            on i.item_id = itv.item_id and tax_id = 8\r\n            where i.Is_deleted=false AND i.item_id = ", itemID, "\r\n\r\n            ) item_tax_values group by item_name" };
            string str = string.Concat(objArray);
            return this.DBUtil.GetDataTable(str);
        }

        public short getCategoryID(int parentId, string category)
        {
            object[] objArray = new object[] { "SELECT category_id FROM item_category WHERE parent_id = ", parentId, " and upper(category_name) = '", category.ToUpper(), "'" };
            string str = string.Concat(objArray);
            return Convert.ToInt16(this.DBUtil.GetSingleValue(str));
        }

        public DataTable getGoodsForAdminUser(int User_id)
        {
            return this.DBUtil.GetDataTable(" SELECT cast(coalesce(SUM(Quantity),'0') as double precision) Quantity,\r\n\t        cast(coalesce(SUM(purchase_unit_price),'0') as double precision) actual_price,\r\n\t        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n\t        cast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n\t        cast(coalesce(SUM(cd),'0') as double precision) cd,\r\n            cast(coalesce(SUM(rd),'0') as double precision) rd,\r\n            cast(coalesce(SUM(vds_amount),'0') as double precision) vds,\r\n            COUNT(*) count,\r\n\t        cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A\r\n        WHERE date_insert BETWEEN (current_date - interval '3 year' + Time '12:01 AM') AND (current_date + Time '11:59 pm') AND Type = 'G'  AND is_deleted = false");
        }

        public DataTable getGoodsForAdminUserDetail()
        {
            return this.DBUtil.GetDataTable("SELECT challan_no,to_char(date_insert,'dd-MON-yyyy')date_insert, Quantity,\r\n\tcast(coalesce(purchase_unit_price,'0') as double precision) purchase_unit_price,\r\n\tcast(coalesce(purchase_sd,'0') as double precision) sd,\r\n\tcast(coalesce(purchase_vat,'0') as double precision) VAT,\r\n\tcast(coalesce(cd,'0') as double precision) cd,\r\n\tcast(coalesce(rd,'0') as double precision) rd,\r\n\tcast(coalesce(vds_amount,'0') as double precision) vds_amount,\r\n\tcast(total_priceT as double precision) total_price,Status\r\n        FROM (select TPD.*,\r\n        CASE\r\n        WHEN TPD.challan_id = -888 THEN 'Production'\r\n        ELSE 'Purchase'\r\n\t    END Status,\r\n        TPS.Type,TPS.challan_no,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n        from trns_purchase_detail AS TPD\r\n        LEFT JOIN trns_purchase_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE date_insert BETWEEN (current_date - interval '3 year' + Time '12:01 AM') AND (current_date + Time '11:59 pm') AND Type = 'G' AND  is_deleted = false");
        }

        public DataTable getGoodsForManagerUser(int User_id)
        {
            return this.DBUtil.GetDataTable("SELECT cast(coalesce(SUM(Quantity),'0') as double precision) Quantity,\r\n\t        cast(coalesce(SUM(purchase_unit_price),'0') as double precision) actual_price,\r\n\t        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n\t        cast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n\t        cast(coalesce(SUM(cd),'0') as double precision) cd,\r\n            cast(coalesce(SUM(rd),'0') as double precision) rd,\r\n            cast(coalesce(SUM(vds_amount),'0') as double precision) vds,\r\n            COUNT(*) count,\r\n\t        cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A\r\n        WHERE date_insert BETWEEN (current_date - interval '1 month' + Time '12:01 AM') AND (current_date + Time '11:59 pm') AND Type = 'G'  AND is_deleted = false AND User_id_insert IN (select employee_id from admn_employee WHERE user_level <> 1)");
        }

        public DataTable getGoodsForManagerUserDetail()
        {
            return this.DBUtil.GetDataTable("SELECT challan_no,to_char(date_insert,'dd-MON-yyyy')date_insert, Quantity,\r\n\tcast(coalesce(purchase_unit_price,'0') as double precision) purchase_unit_price,\r\n\tcast(coalesce(purchase_sd,'0') as double precision) sd,\r\n\tcast(coalesce(purchase_vat,'0') as double precision) VAT,\r\n\tcast(coalesce(cd,'0') as double precision) cd,\r\n\tcast(coalesce(rd,'0') as double precision) rd,\r\n\tcast(coalesce(vds_amount,'0') as double precision) vds_amount,\r\n\tcast(total_priceT as double precision) total_price,Status\r\n        FROM (select TPD.*,\r\n        CASE\r\n        WHEN TPD.challan_id = -888 THEN 'Production'\r\n        ELSE 'Purchase'\r\n\t    END Status,\r\n        TPS.Type,TPS.challan_no,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n        from trns_purchase_detail AS TPD\r\n        LEFT JOIN trns_purchase_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE date_insert BETWEEN (current_date - interval '1 month' + Time '12:01 AM') AND (current_date + Time '11:59 pm') AND Type = 'G'  AND is_deleted = false\r\n        AND User_id_insert IN (select employee_id from admn_employee WHERE user_level <> 1) ");
        }

        public DataTable getGoodsForNormalUser(int User_id)
        {
            string str = string.Concat("SELECT cast(coalesce(SUM(Quantity),'0') as double precision) Quantity,\r\n\t    cast(coalesce(SUM(purchase_unit_price),'0') as double precision) actual_price,\r\n\t    cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n\t    cast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n\t    cast(coalesce(SUM(cd),'0') as double precision) cd,\r\n        cast(coalesce(SUM(rd),'0') as double precision) rd,\r\n        cast(coalesce(SUM(vds_amount),'0') as double precision) vds,\r\n        COUNT(*) count,\r\n\t    cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n        FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n        from trns_purchase_detail AS TPD\r\n        LEFT JOIN trns_purchase_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE date_insert BETWEEN (current_date + Time '12:01 AM') AND (current_date + Time '11:59 pm') AND Type = 'G' AND User_id_insert = ", User_id, " AND is_deleted = false");
            return this.DBUtil.GetDataTable(str);
        }

        public DataTable getGoodsForNormalUserDetail(int User_id)
        {
            string str = string.Concat("SELECT challan_no,to_char(date_insert,'dd-MON-yyyy')date_insert, Quantity,\r\n\tcast(coalesce(purchase_unit_price,'0') as double precision) purchase_unit_price,\r\n\tcast(coalesce(purchase_sd,'0') as double precision) sd,\r\n\tcast(coalesce(purchase_vat,'0') as double precision) VAT,\r\n\tcast(coalesce(cd,'0') as double precision) cd,\r\n\tcast(coalesce(rd,'0') as double precision) rd,\r\n\tcast(coalesce(vds_amount,'0') as double precision) vds_amount,\r\n\tcast(total_priceT as double precision) total_price,Status\r\n        FROM (select TPD.*,\r\n        CASE\r\n        WHEN TPD.challan_id = -888 THEN 'Production'\r\n        ELSE 'Purchase'\r\n\t    END Status,\r\n        TPS.Type,TPS.challan_no,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n        from trns_purchase_detail AS TPD\r\n        LEFT JOIN trns_purchase_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE date_insert BETWEEN (current_date + Time '12:01 AM') AND (current_date + Time '11:59 pm') AND Type = 'G' AND User_id_insert = ", User_id, " AND is_deleted = false");
            return this.DBUtil.GetDataTable(str);
        }

        public DataTable getGoodsForNormalUserDetailForFilter(int User_id)
        {
            string str = string.Concat("SELECT challan_no,to_char(date_insert,'dd-MON-yyyy')date_insert, Quantity,\r\n\tcast(coalesce(purchase_unit_price,'0') as double precision) purchase_unit_price,\r\n\tcast(coalesce(purchase_sd,'0') as double precision) sd,\r\n\tcast(coalesce(purchase_vat,'0') as double precision) VAT,\r\n\tcast(coalesce(cd,'0') as double precision) cd,\r\n\tcast(coalesce(rd,'0') as double precision) rd,\r\n\tcast(coalesce(vds_amount,'0') as double precision) vds_amount,\r\n\tcast(total_priceT as double precision) total_price,Status\r\n        FROM (select TPD.*,\r\n        CASE\r\n        WHEN TPD.challan_id = -888 THEN 'Production'\r\n        ELSE 'Purchase'\r\n\t    END Status,\r\n        TPS.Type,TPS.challan_no,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n        from trns_purchase_detail AS TPD\r\n        LEFT JOIN trns_purchase_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE date_insert BETWEEN (current_date - interval '3 year' + Time '12:01 AM') AND (current_date + Time '11:59 pm') AND Type = 'G' AND User_id_insert = ", User_id, " AND is_deleted = false");
            return this.DBUtil.GetDataTable(str);
        }

        public DataTable getGoodsForNormalUserDetailForFilterManager(int User_id)
        {
            string str = string.Concat("SELECT challan_no,to_char(date_insert,'dd-MON-yyyy')date_insert, Quantity,\r\n\tcast(coalesce(purchase_unit_price,'0') as double precision) purchase_unit_price,\r\n\tcast(coalesce(purchase_sd,'0') as double precision) sd,\r\n\tcast(coalesce(purchase_vat,'0') as double precision) VAT,\r\n\tcast(coalesce(cd,'0') as double precision) cd,\r\n\tcast(coalesce(rd,'0') as double precision) rd,\r\n\tcast(coalesce(vds_amount,'0') as double precision) vds_amount,\r\n\tcast(total_priceT as double precision) total_price,Status\r\n        FROM (select TPD.*,\r\n        CASE\r\n        WHEN TPD.challan_id = -888 THEN 'Production'\r\n        ELSE 'Purchase'\r\n\t    END Status,\r\n        TPS.Type,TPS.challan_no,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n        from trns_purchase_detail AS TPD\r\n        LEFT JOIN trns_purchase_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE date_insert BETWEEN (current_date - interval '1 month' + Time '12:01 AM') AND (current_date + Time '11:59 pm') AND Type = 'G' AND User_id_insert = ", User_id, " AND is_deleted = false");
            return this.DBUtil.GetDataTable(str);
        }

        public int getItemID(string item)
        {
            string str = string.Concat("select item_id from item where item_name = '", item.ToUpper(), "'");
            return Convert.ToInt32(this.DBUtil.GetSingleValue(str));
        }

        public DataTable getItemRate(int itemID)
        {
            string str = string.Concat("select coalesce(vat_rate,0) vat_rate, coalesce(sd_rate,0) sd_rate, coalesce(purchase_unit_price,0) purchase_unit_price  from trns_purchase_detail where item_id = ", itemID, " order by date_insert desc limit 1");
            return this.DBUtil.GetDataTable(str);
        }

        public DataSet getItems()
        {
            return this.DBUtil.GetDataSet("SELECT  item_name, Item_id FROM Item WHERE Is_deleted=false order by item_name", "Item");
        }

        public DataSet getItemsByChallanId(short challanId)
        {
            string str = string.Concat("select i.item_name, tpd.detail_id from trns_purchase_detail tpd inner join Item i on tpd.Item_id=i.Item_id\r\n        where tpd.Is_deleted=false and tpd.Challan_id=", challanId, " order by i.item_name");
            return this.DBUtil.GetDataSet(str, "Item");
        }

        public DataSet getItemTypes()
        {
            return this.DBUtil.GetDataSet("SELECT  code_name, code_id_d, CASE WHEN code_id_d=1 THEN 'I' WHEN code_id_d=2 THEN 'L' END itemCode FROM app_code_detail WHERE Is_deleted=false and code_id_m=12", "Item");
        }

        public DataTable getItemUnitByItemId(int ItemId)
        {
            string str = string.Concat("SELECT unit_name, unit_code, i.unit_id, i.hs_code Hscode, i.item_specification item_specification,\r\n                                      i.is_rebatable, i.is_vds, i.is_exempted\r\n                                from item_unit iu \r\n                                INNER JOIN Item i \r\n                                on iu.unit_id=i.unit_id \r\n                            where iu.Is_deleted=false and i.Item_id=", ItemId);
            return this.DBUtil.GetDataTable(str);
        }

        public DataTable GetLastDateofselectedMonth(string currentMonth)
        {
            string str = string.Concat(" (select (date_trunc('MONTH',to_date('", currentMonth, "','YYYYMMDD')) + INTERVAL '1 MONTH - 1 day')::date)");
            return this.DBUtil.GetDataTable(str);
        }

        public short getMesurementIDD(string mesurement)
        {
            string str = string.Concat("SELECT CODE_ID_D FROM APP_CODE_DETAIL WHERE CODE_ID_M = 4 AND IS_DELETED = false AND upper(CODE_NAME) = '", mesurement.ToUpper(), "'");
            return Convert.ToInt16(this.DBUtil.GetSingleValue(str));
        }

        public short getParentID(string category)
        {
            string str = string.Concat("SELECT category_id FROM item_category WHERE parent_id=0 and upper(category_name) = '", category.ToUpper(), "'");
            return Convert.ToInt16(this.DBUtil.GetSingleValue(str));
        }

        public DataTable GetPaymentInfobyChallanId(int challanId)
        {
            string str = HttpContext.Current.Session["ORGANIZATION_ID"].ToString();
            object[] objArray = new object[] { "select max(TO_CHAR(cth.payment_date,'dd/MM/yyyy')) payment_date\r\n                        from trns_purchase_master as tpm\r\n                        inner join trns_purchase_detail as tpd on tpm.challan_id = tpd.challan_id                        \r\n                        inner join credit_transac_history cth on cth.challan_id = tpd.challan_id \r\n                        where tpm.is_payment_finished=true and tpm.organization_id =  ", str, " and tpd.is_source_tax_deduct = true and tpd.is_deleted = false\r\n                        AND tpd.vds_status = false and tpm.challan_id=", challanId, "\r\n                        group by cth.payment_date" };
            string str1 = string.Concat(objArray);
            return this.DBUtil.GetDataTable(str1);
        }

        public short getPropertyID(string property)
        {
            string str = string.Concat("select property_id from item_property where property_name = '", property.ToUpper(), "'");
            return Convert.ToInt16(this.DBUtil.GetSingleValue(str));
        }

        public DataTable GetPurchaseChartData(string fromDate, string toDate)
        {
            string[] strArrays = new string[] { "select coalesce(sum(tpd.quantity*tpd.purchase_unit_price),0) total_Purchase  from trns_purchase_detail tpd\r\n       inner join trns_purchase_master tpm on tpd.challan_id=tpm.challan_id\r\n       where CAST(tpm.date_challan as DATE) >= to_date('", fromDate, "','dd/MM/yyyy') \r\n        AND CAST(tpm.date_challan as DATE) <= to_date('", toDate, "','dd/MM/yyyy')" };
            string str = string.Concat(strArrays);
            return this.DBUtil.GetDataTable(str);
        }

        public DataTable GetPurchaseSaleChartData(string year)
        {
            string[] strArrays = new string[] { "select  a.date, total_Purchase,total_Sale from\r\n\r\n(select to_char(tpm.date_challan,'Mon, yyyy') as date,to_char(tpm.date_challan,'MM') as mon1,\r\n       \r\n       sum(tpd.quantity*tpd.purchase_unit_price)total_Purchase  from trns_purchase_detail tpd\r\n       inner join trns_purchase_master tpm on tpd.challan_id=tpm.challan_id\r\n      where to_char(tpm.date_challan,'yyyy')='", year, "'\r\ngroup by date,mon1 order by mon1) A,\r\n\r\n\r\n\r\n(select to_char(tpm.date_challan,'Mon, yyyy') as date,to_char(tpm.date_challan,'MM') as mon1,\r\n       \r\n       sum(tpd.quantity*tpd.actual_price)total_Sale  from trns_sale_detail tpd\r\n       inner join trns_sale_master tpm on tpd.challan_id=tpm.challan_id\r\n      where to_char(tpm.date_challan,'yyyy')='", year, "'\r\ngroup by date,mon1 order by mon1)B" };
            string str = string.Concat(strArrays);
            return this.DBUtil.GetDataTable(str);
        }

        public DataTable getPurchaseServicesForAdminUser()
        {
            return this.DBUtil.GetDataTable("SELECT cast(coalesce(SUM(Quantity),'0') as double precision) Quantity,\r\n\t        cast(coalesce(SUM(purchase_unit_price),'0') as double precision) actual_price,\r\n\t        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n\t        cast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n\t        cast(coalesce(SUM(cd),'0') as double precision) cd,\r\n            cast(coalesce(SUM(rd),'0') as double precision) rd,\r\n            cast(coalesce(SUM(vds_amount),'0') as double precision) vds,\r\n            COUNT(*) count,\r\n\t        cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A\r\n        WHERE date_insert BETWEEN (current_date - interval '3 year' + Time '12:01 AM') AND (current_date + Time '11:59 pm') AND Type = 'S' AND is_deleted = false");
        }

        public DataTable getPurchaseServicesForAdminUserDetail()
        {
            return this.DBUtil.GetDataTable(" SELECT challan_no,to_char(date_insert,'dd-MON-yyyy')date_insert, Quantity,\r\n\t    cast(coalesce(purchase_unit_price,'0') as double precision) purchase_unit_price,\r\n\t    cast(coalesce(purchase_sd,'0') as double precision) sd,\r\n\t    cast(coalesce(purchase_vat,'0') as double precision) VAT,\r\n\t    cast(coalesce(cd,'0') as double precision) cd,\r\n\t    cast(coalesce(rd,'0') as double precision) rd,\r\n\t    cast(coalesce(vds_amount,'0') as double precision) vds_amount,\r\n\t    cast(total_priceT as double precision) total_price,Status\r\n        FROM (select TPD.*,\r\n        CASE\r\n        WHEN TPD.challan_id = -888 THEN 'Production'\r\n        ELSE 'Purchase'\r\n\t    END Status,\r\n        TPS.Type,TPS.challan_no,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n        from trns_purchase_detail AS TPD\r\n        LEFT JOIN trns_purchase_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE date_insert BETWEEN (current_date - interval '3 year' + Time '12:01 AM') AND (current_date + Time '11:59 pm') AND Type = 'S' AND is_deleted = false");
        }

        public DataTable getPurchaseServicesForManagerUser()
        {
            return this.DBUtil.GetDataTable("SELECT \r\n\t        cast(coalesce(SUM(Quantity),'0') as double precision) Quantity,\r\n\t        cast(coalesce(SUM(purchase_unit_price),'0') as double precision) actual_price,\r\n\t        cast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n\t        cast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n\t        cast(coalesce(SUM(cd),'0') as double precision) cd,\r\n            cast(coalesce(SUM(rd),'0') as double precision) rd,\r\n            cast(coalesce(SUM(vds_amount),'0') as double precision) vds,\r\n            COUNT(*) count,\r\n\t        cast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n            FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n            from trns_purchase_detail AS TPD\r\n            LEFT JOIN trns_purchase_master TPS\r\n            ON TPD.challan_id =  TPS.challan_id\r\n            )A\r\n            WHERE date_insert BETWEEN (current_date - interval '1 month' + Time '12:01 AM') AND (current_date + Time '11:59 pm') AND Type = 'S' AND is_deleted = false AND User_id_insert IN (select employee_id from admn_employee WHERE user_level <> 1)");
        }

        public DataTable getPurchaseServicesForManagerUserDetail()
        {
            return this.DBUtil.GetDataTable("SELECT challan_no,to_char(date_insert,'dd-MON-yyyy')date_insert, Quantity,\r\n\tcast(coalesce(purchase_unit_price,'0') as double precision) purchase_unit_price,\r\n\tcast(coalesce(purchase_sd,'0') as double precision) sd,\r\n\tcast(coalesce(purchase_vat,'0') as double precision) VAT,\r\n\tcast(coalesce(cd,'0') as double precision) cd,\r\n\tcast(coalesce(rd,'0') as double precision) rd,\r\n\tcast(coalesce(vds_amount,'0') as double precision) vds_amount,\r\n\tcast(total_priceT as double precision) total_price,Status\r\n        FROM (select TPD.*,\r\n        CASE\r\n        WHEN TPD.challan_id = -888 THEN 'Production'\r\n        ELSE 'Purchase'\r\n\t    END Status,\r\n        TPS.Type,TPS.challan_no,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n        from trns_purchase_detail AS TPD\r\n        LEFT JOIN trns_purchase_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n            WHERE date_insert BETWEEN (current_date - interval '1 month' + Time '12:01 AM') AND (current_date + Time '11:59 pm') AND Type = 'S' AND is_deleted = false\r\n        AND User_id_insert IN (select employee_id from admn_employee WHERE user_level <> 1)");
        }

        public DataTable getPurchaseServicesForNormalUser(int User_id)
        {
            string str = string.Concat(" SELECT cast(coalesce(SUM(Quantity),'0') as double precision) Quantity,\r\n\tcast(coalesce(SUM(purchase_unit_price),'0') as double precision) actual_price,\r\n\tcast(coalesce(SUM(purchase_sd),'0') as double precision) sd,\r\n\tcast(coalesce(SUM(purchase_vat),'0') as double precision) VAT,\r\n\tcast(coalesce(SUM(cd),'0') as double precision) cd,\r\n        cast(coalesce(SUM(rd),'0') as double precision) rd,\r\n        cast(coalesce(SUM(vds_amount),'0') as double precision) vds,\r\n        COUNT(*) count,\r\n\tcast(coalesce(SUM(total_priceT),'0') as double precision) total_price\r\n        FROM (select TPD.*,TPS.Type,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n        from trns_purchase_detail AS TPD\r\n        LEFT JOIN trns_purchase_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE date_insert BETWEEN (current_date + Time '12:01 AM') AND (current_date + Time '11:59 pm') AND Type = 'S' AND User_id_insert = ", User_id, " AND is_deleted = false");
            return this.DBUtil.GetDataTable(str);
        }

        public DataTable getPurchaseServicesForNormalUserDetal(int User_id)
        {
            string str = string.Concat("SELECT challan_no,to_char(date_insert,'dd-MON-yyyy')date_insert, Quantity,\r\n\tcast(coalesce(purchase_unit_price,'0') as double precision) purchase_unit_price,\r\n\tcast(coalesce(purchase_sd,'0') as double precision) sd,\r\n\tcast(coalesce(purchase_vat,'0') as double precision) VAT,\r\n\tcast(coalesce(cd,'0') as double precision) cd,\r\n\tcast(coalesce(rd,'0') as double precision) rd,\r\n\tcast(coalesce(vds_amount,'0') as double precision) vds_amount,\r\n\tcast(total_priceT as double precision) total_price,Status\r\n        FROM (select TPD.*,\r\n        CASE\r\n        WHEN TPD.challan_id = -888 THEN 'Production'\r\n        ELSE 'Purchase'\r\n\t    END Status,\r\n        TPS.Type,TPS.challan_no,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n        from trns_purchase_detail AS TPD\r\n        LEFT JOIN trns_purchase_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE date_insert BETWEEN (current_date + Time '12:01 AM') AND (current_date + Time '11:59 pm') AND Type = 'S' AND User_id_insert = ", User_id, " AND is_deleted = false");
            return this.DBUtil.GetDataTable(str);
        }

        public DataTable getPurchaseServicesForNormalUserDetalForFilter(int User_id)
        {
            string str = string.Concat("SELECT challan_no,to_char(date_insert,'dd-MON-yyyy')date_insert, Quantity,\r\n\tcast(coalesce(purchase_unit_price,'0') as double precision) purchase_unit_price,\r\n\tcast(coalesce(purchase_sd,'0') as double precision) sd,\r\n\tcast(coalesce(purchase_vat,'0') as double precision) VAT,\r\n\tcast(coalesce(cd,'0') as double precision) cd,\r\n\tcast(coalesce(rd,'0') as double precision) rd,\r\n\tcast(coalesce(vds_amount,'0') as double precision) vds_amount,\r\n\tcast(total_priceT as double precision) total_price,Status\r\n        FROM (select TPD.*,\r\n        CASE\r\n        WHEN TPD.challan_id = -888 THEN 'Production'\r\n        ELSE 'Purchase'\r\n\t    END Status,\r\n        TPS.Type,TPS.challan_no,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n        from trns_purchase_detail AS TPD\r\n        LEFT JOIN trns_purchase_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE date_insert BETWEEN (current_date - interval '3 year' + Time '12:01 AM') AND (current_date + Time '11:59 pm') AND Type = 'S' AND User_id_insert = ", User_id, " AND is_deleted = false");
            return this.DBUtil.GetDataTable(str);
        }

        public DataTable getPurchaseServicesForNormalUserDetalForFilterManager(int User_id)
        {
            string str = string.Concat("SELECT challan_no,to_char(date_insert,'dd-MON-yyyy')date_insert, Quantity,\r\n\tcast(coalesce(purchase_unit_price,'0') as double precision) purchase_unit_price,\r\n\tcast(coalesce(purchase_sd,'0') as double precision) sd,\r\n\tcast(coalesce(purchase_vat,'0') as double precision) VAT,\r\n\tcast(coalesce(cd,'0') as double precision) cd,\r\n\tcast(coalesce(rd,'0') as double precision) rd,\r\n\tcast(coalesce(vds_amount,'0') as double precision) vds_amount,\r\n\tcast(total_priceT as double precision) total_price,Status\r\n        FROM (select TPD.*,\r\n        CASE\r\n        WHEN TPD.challan_id = -888 THEN 'Production'\r\n        ELSE 'Purchase'\r\n\t    END Status,\r\n        TPS.Type,TPS.challan_no,(TPD.Quantity * TPD.purchase_unit_price) + TPD.purchase_vat + TPD.purchase_sd total_priceT \r\n        from trns_purchase_detail AS TPD\r\n        LEFT JOIN trns_purchase_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE date_insert BETWEEN (current_date - interval '1 month' + Time '12:01 AM') AND (current_date + Time '11:59 pm') AND Type = 'S' AND User_id_insert = ", User_id, " AND is_deleted = false");
            return this.DBUtil.GetDataTable(str);
        }

        public DataTable GetPurchaseVDSPaidChartData(string fromDate, string toDate)
        {
            string str = HttpContext.Current.Session["ORGANIZATION_ID"].ToString();
            string[] strArrays = new string[] { "select coalesce(sum(tpd.purchase_vat),0) totalVATP                       \r\n                         from trns_purchase_master as tpm\r\n                         inner join trns_purchase_detail as tpd on tpd.Challan_id=tpm.Challan_id \r\n                         WHERE CAST(tpm.date_challan as DATE) >= to_date('", fromDate, "','dd/MM/yyyy') \r\n        AND CAST(tpm.date_challan as DATE) <= to_date('", toDate, "','dd/MM/yyyy') and tpm.organization_id=", str, "  and tpd.vds_amount!=0 and tpd.is_source_tax_deduct=true and is_vat_paid=true" };
            string str1 = string.Concat(strArrays);
            return this.DBUtil.GetDataTable(str1);
        }

        public DataTable GetPurchaseVDSPayableChartData(string fromDate, string toDate)
        {
            string str = HttpContext.Current.Session["ORGANIZATION_ID"].ToString();
            string[] strArrays = new string[] { "select coalesce(sum(tpd.purchase_vat),0) totalVAT                       \r\n                         from trns_purchase_master as tpm\r\n                         inner join trns_purchase_detail as tpd on tpd.Challan_id=tpm.Challan_id \r\n                         WHERE CAST(tpm.date_challan as DATE) >= to_date('", fromDate, "','dd/MM/yyyy') \r\n        AND CAST(tpm.date_challan as DATE) <= to_date('", toDate, "','dd/MM/yyyy') and tpm.organization_id=", str, "  and tpd.vds_amount!=0 and tpd.is_source_tax_deduct=true and is_vat_paid=false" };
            string str1 = string.Concat(strArrays);
            return this.DBUtil.GetDataTable(str1);
        }

        public DataTable GetRawmaterials()
        {
            DataTable dataTable;
            try
            {
                string str = string.Concat("select item_name , item_id, product_type, item_type from item where product_type = 'R' AND organization_id=", Convert.ToInt32(HttpContext.Current.Session["ORGANIZATION_ID"]));
                dataTable = this.DBUtil.GetDataTable(str);
            }
            catch (Exception exception)
            {
                Console.WriteLine(exception);
                throw;
            }
            return dataTable;
        }

        public DataTable GetSaleChartData(string fromDate, string toDate)
        {
            string[] strArrays = new string[] { "select    coalesce(sum(tpd.quantity*tpd.actual_price),0) total_Sale  from trns_sale_detail tpd\r\n       inner join trns_sale_master tpm on tpd.challan_id=tpm.challan_id     \r\n        where CAST(tpm.date_challan as DATE) >= to_date('", fromDate, "','dd/MM/yyyy') \r\n        AND CAST(tpm.date_challan as DATE) <= to_date('", toDate, "','dd/MM/yyyy')" };
            string str = string.Concat(strArrays);
            return this.DBUtil.GetDataTable(str);
        }

        public DataTable getSaleGoodsForAdminUser(int User_id)
        {
            return this.DBUtil.GetDataTable("SELECT coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE date_insert BETWEEN (current_date - interval '3 year' + Time '12:01 AM') AND (current_date + Time '11:59 pm') AND Type = 'G'  AND is_deleted = false");
        }

        public DataTable getSaleGoodsForAdminUserDetail()
        {
            return this.DBUtil.GetDataTable("SELECT challan_no,to_char(date_insert,'dd-MON-yyyy') date_insert,coalesce((Quantity),'0') Quantity,coalesce((actual_price),'0') purchase_unit_price,coalesce((SD),'0') sd,coalesce((VAT),'0') vat,\r\n\t    0 as CD,0 AS RD, 0 AS vds_amount,\r\n        cast(coalesce((total_priceT),'0') as double precision) total_price\r\n        FROM (select TPD.*,TPS.Type,TPS.challan_no,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE date_insert BETWEEN (current_date - interval '3 year' + Time '12:01 AM') AND (current_date + Time '11:59 pm') AND Type = 'G' AND  is_deleted = false");
        }

        public DataTable getSaleGoodsForManagerUser(int User_id)
        {
            return this.DBUtil.GetDataTable("SELECT coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE date_insert BETWEEN (current_date - interval '1 month' + Time '12:01 AM') AND (current_date + Time '11:59 pm') AND Type = 'G'  AND is_deleted = false AND User_id_insert IN (select employee_id from admn_employee WHERE user_level <> 1)");
        }

        public DataTable getSaleGoodsForManagerUserDetail()
        {
            return this.DBUtil.GetDataTable("SELECT challan_no,to_char(date_insert,'dd-MON-yyyy') date_insert,coalesce((Quantity),'0') Quantity,coalesce((actual_price),'0') purchase_unit_price,coalesce((SD),'0') sd,coalesce((VAT),'0') vat,\r\n\t    0 as CD,0 AS RD, 0 AS vds_amount,\r\n        cast(coalesce((total_priceT),'0') as double precision) total_price\r\n        FROM (select TPD.*,TPS.Type ,TPS.challan_no,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE date_insert BETWEEN (current_date - interval '1 month' + Time '12:01 AM') AND (current_date + Time '11:59 pm') AND Type = 'G'  AND is_deleted = false\r\n        AND User_id_insert IN (select employee_id from admn_employee WHERE user_level <> 1)");
        }

        public DataTable getSaleGoodsForNormalUser(int User_id)
        {
            string str = string.Concat("SELECT coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE date_insert BETWEEN (current_date + Time '12:01 AM') AND (current_date + Time '11:59 pm') AND Type = 'G' AND User_id_insert = ", User_id, " AND is_deleted = false");
            return this.DBUtil.GetDataTable(str);
        }

        public DataTable getSaleGoodsForNormalUserDetail(int User_id)
        {
            string str = string.Concat("SELECT challan_no,to_char(date_insert,'dd-MON-yyyy') date_insert,coalesce((Quantity),'0') Quantity,coalesce((actual_price),'0') purchase_unit_price,coalesce((SD),'0') sd,coalesce((VAT),'0') vat,\r\n\t    0 as CD,0 AS RD, 0 AS vds_amount,\r\n        cast(coalesce((total_priceT),'0') as double precision) total_price\r\n        FROM (select TPD.*,TPS.Type ,TPS.challan_no,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE date_insert BETWEEN (current_date + Time '12:01 AM') AND (current_date + Time '11:59 pm') AND Type = 'G' AND User_id_insert = ", User_id, " AND is_deleted = false");
            return this.DBUtil.GetDataTable(str);
        }

        public DataTable getSaleGoodsForNormalUserDetailForFilter(int User_id)
        {
            string str = string.Concat("SELECT challan_no,to_char(date_insert,'dd-MON-yyyy') date_insert,coalesce((Quantity),'0') Quantity,coalesce((actual_price),'0') purchase_unit_price,coalesce((SD),'0') sd,coalesce((VAT),'0') vat,\r\n\t    0 as CD,0 AS RD, 0 AS vds_amount,\r\n        cast(coalesce((total_priceT),'0') as double precision) total_price\r\n        FROM (select TPD.*,TPS.Type ,TPS.challan_no,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE date_insert BETWEEN (current_date - interval '3 year' + Time '12:01 AM') AND (current_date + Time '11:59 pm') AND Type = 'G' AND User_id_insert = ", User_id, " AND is_deleted = false");
            return this.DBUtil.GetDataTable(str);
        }

        public DataTable getSaleGoodsForNormalUserDetailForFilterManager(int User_id)
        {
            string str = string.Concat("SELECT challan_no,to_char(date_insert,'dd-MON-yyyy') date_insert,coalesce((Quantity),'0') Quantity,coalesce((actual_price),'0') purchase_unit_price,coalesce((SD),'0') sd,coalesce((VAT),'0') vat,\r\n\t    0 as CD,0 AS RD, 0 AS vds_amount,\r\n        cast(coalesce((total_priceT),'0') as double precision) total_price\r\n        FROM (select TPD.*,TPS.Type ,TPS.challan_no,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE date_insert BETWEEN (current_date - interval '1 month' + Time '12:01 AM') AND (current_date + Time '11:59 pm') AND Type = 'G' AND User_id_insert = ", User_id, " AND is_deleted = false");
            return this.DBUtil.GetDataTable(str);
        }

        public DataTable getSaleServicesForAdminDetail()
        {
            return this.DBUtil.GetDataTable("SELECT challan_no,to_char(date_insert,'dd-MON-yyyy') date_insert,coalesce((Quantity),'0') Quantity,coalesce((actual_price),'0') purchase_unit_price,coalesce((SD),'0') sd,coalesce((VAT),'0') vat,\r\n\t    0 as CD,0 AS RD, 0 AS vds_amount,\r\n        cast(coalesce((total_priceT),'0') as double precision) total_price\r\n        FROM (select TPD.*,TPS.Type,TPS.challan_no,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE date_insert BETWEEN (current_date - interval '3 year' + Time '12:01 AM') AND (current_date + Time '11:59 pm') AND Type = 'S' AND is_deleted = false");
        }

        public DataTable getSaleServicesForAdminUser()
        {
            return this.DBUtil.GetDataTable("SELECT coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE date_insert BETWEEN (current_date - interval '3 year' + Time '12:01 AM') AND (current_date + Time '11:59 pm') AND Type = 'S' AND is_deleted = false");
        }

        public DataTable getSaleServicesForManagerUser()
        {
            return this.DBUtil.GetDataTable("SELECT coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE date_insert BETWEEN (current_date - interval '1 month' + Time '12:01 AM') AND (current_date + Time '11:59 pm') AND Type = 'S' AND is_deleted = false AND User_id_insert IN (select employee_id from admn_employee WHERE user_level <> 1)");
        }

        public DataTable getSaleServicesForManagerUserDetail()
        {
            return this.DBUtil.GetDataTable("SELECT challan_no,to_char(date_insert,'dd-MON-yyyy') date_insert,coalesce((Quantity),'0') Quantity,coalesce((actual_price),'0') purchase_unit_price,coalesce((SD),'0') sd,coalesce((VAT),'0') vat,\r\n\t    0 as CD,0 AS RD, 0 AS vds_amount,\r\n        cast(coalesce((total_priceT),'0') as double precision) total_price\r\n        FROM (select TPD.*,TPS.Type ,TPS.challan_no,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE date_insert BETWEEN (current_date - interval '1 month' + Time '12:01 AM') AND (current_date + Time '11:59 pm') AND Type = 'S' AND is_deleted = false AND User_id_insert IN (select employee_id from admn_employee WHERE user_level <> 1)");
        }

        public DataTable getSaleServicesForNormalDetail(int User_id)
        {
            string str = string.Concat("SELECT challan_no,to_char(date_insert,'dd-MON-yyyy') date_insert,coalesce((Quantity),'0') Quantity,coalesce((actual_price),'0') purchase_unit_price,coalesce((SD),'0') sd,coalesce((VAT),'0') vat,\r\n\t    0 as CD,0 AS RD, 0 AS vds_amount,\r\n        cast(coalesce((total_priceT),'0') as double precision) total_price\r\n        FROM (select TPD.*,TPS.Type ,TPS.challan_no,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE date_insert BETWEEN (current_date + Time '12:01 AM') AND (current_date + Time '11:59 pm') AND Type = 'S' AND User_id_insert = ", User_id, " AND is_deleted = false");
            return this.DBUtil.GetDataTable(str);
        }

        public DataTable getSaleServicesForNormalDetailForFilter(int User_id)
        {
            string str = string.Concat("SELECT challan_no,to_char(date_insert,'dd-MON-yyyy') date_insert,coalesce((Quantity),'0') Quantity,coalesce((actual_price),'0') purchase_unit_price,coalesce((SD),'0') sd,coalesce((VAT),'0') vat,\r\n\t    0 as CD,0 AS RD, 0 AS vds_amount,\r\n        cast(coalesce((total_priceT),'0') as double precision) total_price\r\n        FROM (select TPD.*,TPS.Type ,TPS.challan_no,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE date_insert BETWEEN (current_date - interval '3 year' + Time '12:01 AM') AND (current_date + Time '11:59 pm') AND Type = 'S' AND User_id_insert = ", User_id, " AND is_deleted = false");
            return this.DBUtil.GetDataTable(str);
        }

        public DataTable getSaleServicesForNormalDetailForFilterManager(int User_id)
        {
            string str = string.Concat("SELECT challan_no,to_char(date_insert,'dd-MON-yyyy') date_insert,coalesce((Quantity),'0') Quantity,coalesce((actual_price),'0') purchase_unit_price,coalesce((SD),'0') sd,coalesce((VAT),'0') vat,\r\n\t    0 as CD,0 AS RD, 0 AS vds_amount,\r\n        cast(coalesce((total_priceT),'0') as double precision) total_price\r\n        FROM (select TPD.*,TPS.Type ,TPS.challan_no,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE date_insert BETWEEN (current_date - interval '1 month' + Time '12:01 AM') AND (current_date + Time '11:59 pm') AND Type = 'S' AND User_id_insert = ", User_id, " AND is_deleted = false");
            return this.DBUtil.GetDataTable(str);
        }

        public DataTable getSaleServicesForNormalUser(int User_id)
        {
            string str = string.Concat("SELECT coalesce(SUM(Quantity),'0') Quantity,coalesce(SUM(actual_price),'0') actual_price,coalesce(SUM(SD),'0') sd,coalesce(SUM(VAT),'0') vat,\r\n        COUNT(*) count,coalesce(SUM(total_priceT),'0') total_price\r\n        FROM (select TPD.*,TPS.Type ,(TPD.Quantity * TPD.actual_price) + TPD.sd + TPD.vat total_priceT\r\n        from trns_sale_detail AS TPD\r\n        LEFT JOIN trns_sale_master TPS\r\n        ON TPD.challan_id =  TPS.challan_id\r\n        )A\r\n        WHERE date_insert BETWEEN (current_date + Time '12:01 AM') AND (current_date + Time '11:59 pm') AND Type = 'S' AND User_id_insert = ", User_id, " AND is_deleted = false");
            return this.DBUtil.GetDataTable(str);
        }

        public DataTable GetSixMonthlistOf(string currentYear)
        {
            string[] strArrays = new string[] { " SELECT TO_CHAR(TO_DATE (month::text, 'MM'), 'Mon') mon,year,month,\r\n                                   to_char(date_trunc('month', to_date(TO_CHAR(\r\n                                   TO_DATE (month::text, 'MM'), 'Month'), 'Month')+ ' 1month'::interval)-'1day'::interval, 'DD/mm/'::text)::text date\r\n                                   from\r\n                                   (SELECT  EXTRACT('MON' FROM d) AS month,EXTRACT('year' FROM d) AS year\r\n                                   FROM\r\n                                   GENERATE_SERIES(\r\n                                   '", currentYear, "'::timestamp,\r\n                                  '", currentYear, "'::timestamp - interval '5 months',\r\n                                   interval '-1 month') AS d order by  month)a order by year" };
            string str = string.Concat(strArrays);
            return this.DBUtil.GetDataTable(str);
        }

        public short getUnitID(string unit)
        {
            string str = string.Concat("select unit_id from item_unit where upper(unit_code) = '", unit.ToUpper(), "'");
            return Convert.ToInt16(this.DBUtil.GetSingleValue(str));
        }

        public short getUnitIDByName(string unit)
        {
            string str = string.Concat("select unit_id from item_unit where upper(unit_code) = '", unit.ToUpper(), "'");
            return Convert.ToInt16(this.DBUtil.GetSingleValue(str));
        }

        public DataTable getvatsd()
        {
            return this.DBUtil.GetDataTable("select vat, sd from balance");
        }

        public DataTable ImportInfo(string fromDate, string toDate)
        {
            string str = HttpContext.Current.Session["ORGANIZATION_ID"].ToString();
            string[] strArrays = new string[] { "select coalesce(sum(tpd.quantity*tpd.purchase_unit_price),0) totalPrice ,coalesce(sum(tpd.purchase_vat),0) totalVAT                       \r\n                         from trns_purchase_master as tpm\r\n                         inner join trns_purchase_detail as tpd on tpd.Challan_id=tpm.Challan_id \r\n                         WHERE CAST(tpm.date_challan as DATE) >= to_date('", fromDate, "','dd/MM/yyyy') \r\n        AND CAST(tpm.date_challan as DATE) <= to_date('", toDate, "','dd/MM/yyyy') and tpm.organization_id=", str, " and tpm.purchase_type='I'     " };
            string str1 = string.Concat(strArrays);
            return this.DBUtil.GetDataTable(str1);
        }

        public DataTable IssuedChallan()
        {
            string str = HttpContext.Current.Session["ORGANIZATION_ID"].ToString();
            string str1 = string.Concat("  select tpm.challan_id, tpm.challan_no,i.item_name,TO_CHAR(tpm.vds_cert_issued_date,'dd/MM/yyyy') date_challan,tp.party_name,case when tpd.vds_amount = 0 then tpd.purchase_vat else tpd.vds_amount end  vds_amount\r\n                        from trns_purchase_master as tpm\r\n                        inner join trns_purchase_detail as tpd on tpm.challan_id = tpd.challan_id \r\n                        inner join item as i on i.item_id = tpd.item_id\r\n                        inner join trns_party tp  on tp.party_id = tpm.party_id\r\n                        left join trns_treasury_challan ttc on tpm.challan_no = ttc.challan_numbers\r\n                        where tpm.is_payment_finished=true and is_vat_paid=true and tpm.organization_id = ", str, " and tpd.is_source_tax_deduct = true and tpd.is_deleted = false AND tpd.vds_status = false   and tpm.vds_cert_issued_no is not null\r\n                        group by tpm.challan_id,tpd.purchase_vat,tpd.vds_amount,tpm.challan_no,tpm.vds_cert_issued_date,i.item_name,tp.party_name");
            return this.DBUtil.GetDataTable(str1);
        }

        public DataTable IssuedChallanalreadyExpire()
        {
            string str = DateTime.Today.AddDays(-3).ToString();
            string str1 = HttpContext.Current.Session["ORGANIZATION_ID"].ToString();
            string[] strArrays = new string[] { "   select tpm.challan_no,i.item_name,TO_CHAR(tpm.vds_cert_issued_date,'dd/MM/yyyy') date_challan,tp.party_name,case when tpd.vds_amount = 0 then tpd.purchase_vat else tpd.vds_amount end  vds_amount\r\n                        from trns_purchase_master as tpm\r\n                        inner join trns_purchase_detail as tpd on tpm.challan_id = tpd.challan_id \r\n                        inner join item as i on i.item_id = tpd.item_id\r\n                        inner join trns_party tp  on tp.party_id = tpm.party_id\r\n                        left join trns_treasury_challan ttc on tpm.challan_no = ttc.challan_numbers\r\n                        where tpm.organization_id = ", str1, " and tpd.is_source_tax_deduct = true and tpd.is_deleted = false AND tpd.vds_status = false   and tpm.vds_cert_issued_no is not null\r\n                        and TO_DATE(TO_CHAR(tpm.vds_cert_issued_date,'dd/MM/yyyy'),'dd/MM/yyyy')<TO_DATE('", str, "','dd/MM/yyyy')  and tpm.is_vat_paid=false\r\n                        --and vds_cert_issued_date<='19/12/2019 12:00:00 AM'\r\n                        group by tpd.purchase_vat,tpd.vds_amount,i.item_name,tpm.challan_no,tpm.vds_cert_issued_date,tp.party_name" };
            string str2 = string.Concat(strArrays);
            return this.DBUtil.GetDataTable(str2);
        }

        public DataTable IssuedChallanExpire()
        {
            string str = DateTime.Today.AddDays(-3).ToString();
            string str1 = HttpContext.Current.Session["ORGANIZATION_ID"].ToString();
            string[] strArrays = new string[] { "   select tpm.challan_no,TO_CHAR(tpm.vds_cert_issued_date,'dd/MM/yyyy') date_challan,i.item_name,tp.party_name,case when tpd.vds_amount = 0 then tpd.purchase_vat else tpd.vds_amount end  vds_amount\r\n                        from trns_purchase_master as tpm\r\n                        inner join trns_purchase_detail as tpd on tpm.challan_id = tpd.challan_id \r\n                        inner join item as i on i.item_id = tpd.item_id\r\n                        inner join trns_party tp  on tp.party_id = tpm.party_id\r\n                        left join trns_treasury_challan ttc on tpm.challan_no = ttc.challan_numbers\r\n                        where tpm.organization_id = ", str1, " and tpd.is_source_tax_deduct = true and tpd.is_deleted = false AND tpd.vds_status = false   and tpm.vds_cert_issued_no is not null\r\n                        and TO_DATE(TO_CHAR(tpm.vds_cert_issued_date,'dd/MM/yyyy'),'dd/MM/yyyy')=TO_DATE('", str, "','dd/MM/yyyy')  and tpm.is_vat_paid=false\r\n                        --and vds_cert_issued_date<='19/12/2019 12:00:00 AM'\r\n                        group by tpd.purchase_vat,tpd.vds_amount,tpm.challan_no,tpm.vds_cert_issued_date,i.item_name,tp.party_name" };
            string str2 = string.Concat(strArrays);
            return this.DBUtil.GetDataTable(str2);
        }

        public DataTable IssuedChallanList()
        {
            string str = HttpContext.Current.Session["ORGANIZATION_ID"].ToString();
            string str1 = string.Concat("    select tpm.challan_no,i.item_name,TO_CHAR(tpm.date_challan,'dd/MM/yyyy') date_challan,tp.party_name,case when tpd.vds_amount = 0 then tpd.purchase_vat else tpd.vds_amount end  vds_amount\r\n                        from trns_purchase_master as tpm\r\n                        inner join trns_purchase_detail as tpd on tpm.challan_id = tpd.challan_id \r\n                        inner join item as i on i.item_id = tpd.item_id\r\n                        inner join trns_party tp  on tp.party_id = tpm.party_id\r\n                        left join trns_treasury_challan ttc on tpm.challan_no = ttc.challan_numbers\r\n                        where tpm.organization_id = ", str, " and tpd.is_source_tax_deduct = true and tpd.is_deleted = false AND tpd.vds_status = false\r\n                        group by tpd.purchase_vat,tpd.vds_amount,tpm.challan_no,i.item_name,tpm.date_challan,tp.party_name");
            return this.DBUtil.GetDataTable(str1);
        }

        public DataTable LoadUserListForAdmin()
        {
            return this.DBUtil.GetDataTable("select * from admn_employee where is_deleted = false");
        }

        public DataTable LoadUserListForManager()
        {
            return this.DBUtil.GetDataTable("select * from admn_employee where is_deleted = false AND user_level <> 1");
        }

        public DataTable LocalPurchaseInfo(string fromDate, string toDate)
        {
            string str = HttpContext.Current.Session["ORGANIZATION_ID"].ToString();
            string[] strArrays = new string[] { "select coalesce(sum(tpd.quantity*tpd.purchase_unit_price),0) totalPrice ,coalesce(sum(tpd.purchase_vat),0) totalVAT                       \r\n                         from trns_purchase_master as tpm\r\n                         inner join trns_purchase_detail as tpd on tpd.Challan_id=tpm.Challan_id \r\n                         WHERE CAST(tpm.date_challan as DATE) >= to_date('", fromDate, "','dd/MM/yyyy') \r\n        AND CAST(tpm.date_challan as DATE) <= to_date('", toDate, "','dd/MM/yyyy') and tpm.organization_id=", str, " and tpm.purchase_type='L'     " };
            string str1 = string.Concat(strArrays);
            return this.DBUtil.GetDataTable(str1);
        }

        public DataTable PayableVDSList()
        {
            string str = HttpContext.Current.Session["ORGANIZATION_ID"].ToString();
            string str1 = string.Concat("select count(*)\r\n                 from trns_purchase_master as tpm\r\n                        inner join trns_purchase_detail as tpd on tpm.challan_id = tpd.challan_id \r\n                        inner join item as i on i.item_id = tpd.item_id\r\n                        inner join trns_party tp  on tp.party_id = tpm.party_id\r\n                        where tpm.organization_id = ", str, " and tpd.is_source_tax_deduct = true and tpd.is_deleted = false AND tpd.vds_status = false\r\n                        group by tpm.challan_id,tpd.purchase_vat,tpd.vds_amount,tpm.challan_no,i.item_name,tp.party_name");
            return this.DBUtil.GetDataTable(str1);
        }

        public DataTable PayableVDSListPaid()
        {
            string str = HttpContext.Current.Session["ORGANIZATION_ID"].ToString();
            string str1 = string.Concat("  select max(TO_CHAR(cth.payment_date,'dd/MM/yyyy')) payment_date,tpm.challan_id, tpm.challan_no,i.item_name,TO_CHAR(tpm.date_challan,'dd/MM/yyyy') date_challan,tp.party_name,case when tpd.vds_amount = 0 then tpd.purchase_vat else tpd.vds_amount end  vds_amount\r\n                        from trns_purchase_master as tpm\r\n                        inner join trns_purchase_detail as tpd on tpm.challan_id = tpd.challan_id \r\n                        inner join item as i on i.item_id = tpd.item_id\r\n                        inner join trns_party tp  on tp.party_id = tpm.party_id\r\n                        left join credit_transac_history cth on cth.challan_id = tpd.challan_id \r\n                        where tpm.is_payment_finished=true and tpm.organization_id =  ", str, " and tpd.is_source_tax_deduct = true and tpd.is_deleted = false AND tpd.vds_status = false\r\n                        group by tpm.challan_id,tpd.purchase_vat,tpd.vds_amount,tpm.challan_no,tpm.vds_cert_issued_date,i.item_name,tp.party_name");
            return this.DBUtil.GetDataTable(str1);
        }

        public DataTable PayableVDSListUnPaid()
        {
            string str = HttpContext.Current.Session["ORGANIZATION_ID"].ToString();
            string str1 = string.Concat("  select tpm.challan_id, tpm.challan_no,i.item_name,TO_CHAR(tpm.date_challan,'dd/MM/yyyy') date_challan,tp.party_name,case when tpd.vds_amount = 0 then tpd.purchase_vat else tpd.vds_amount end  vds_amount\r\n                        from trns_purchase_master as tpm\r\n                        inner join trns_purchase_detail as tpd on tpm.challan_id = tpd.challan_id \r\n                        inner join item as i on i.item_id = tpd.item_id\r\n                        inner join trns_party tp  on tp.party_id = tpm.party_id                         \r\n                        where tpm.is_payment_finished=false and tpm.organization_id =  ", str, " and tpd.is_source_tax_deduct = true and tpd.is_deleted = false AND tpd.vds_status = false\r\n                        group by tpm.challan_id,tpd.purchase_vat,tpd.vds_amount,tpm.challan_no,tpm.vds_cert_issued_date,i.item_name,tp.party_name");
            return this.DBUtil.GetDataTable(str1);
        }

        public DataTable PurchaseVATInfo(string fromDate, string toDate)
        {
            string str = HttpContext.Current.Session["ORGANIZATION_ID"].ToString();
            string[] strArrays = new string[] { "select coalesce(sum(tpd.purchase_vat),0) totalVAT                       \r\n                         from trns_purchase_master as tpm\r\n                         inner join trns_purchase_detail as tpd on tpd.Challan_id=tpm.Challan_id \r\n                         WHERE CAST(tpm.date_challan as DATE) >= to_date('", fromDate, "','dd/MM/yyyy') \r\n        AND CAST(tpm.date_challan as DATE) <= to_date('", toDate, "','dd/MM/yyyy') and tpm.organization_id=", str, "  and tpd.vds_amount=0 and tpd.is_source_tax_deduct=false and tpm.purchase_type in('L','I')" };
            string str1 = string.Concat(strArrays);
            return this.DBUtil.GetDataTable(str1);
        }

        public DataTable PurchaseVDSInfo(string fromDate, string toDate)
        {
            string str = HttpContext.Current.Session["ORGANIZATION_ID"].ToString();
            string[] strArrays = new string[] { "select coalesce(sum(tpd.purchase_vat),0) totalVAT                       \r\n                         from trns_purchase_master as tpm\r\n                         inner join trns_purchase_detail as tpd on tpd.Challan_id=tpm.Challan_id \r\n                         WHERE  CAST(tpm.date_challan as DATE) >= to_date('", fromDate, "','dd/MM/yyyy') \r\n        AND CAST(tpm.date_challan as DATE) <= to_date('", toDate, "','dd/MM/yyyy') and tpm.organization_id=", str, " and  tpd.vds_amount!=0 and tpd.is_source_tax_deduct=true" };
            string str1 = string.Concat(strArrays);
            return this.DBUtil.GetDataTable(str1);
        }

        public DataTable PurchaseVDSInfoUpto(string fromDate, string toDate)
        {
            HttpContext.Current.Session["ORGANIZATION_ID"].ToString();
            string str = string.Concat("select coalesce(sum(tpd.purchase_vat),0) totalVATP                       \r\n                         from trns_purchase_master as tpm\r\n                         inner join trns_purchase_detail as tpd on tpd.Challan_id=tpm.Challan_id \r\n                         WHERE CAST(tpm.date_challan as DATE) < to_date('", fromDate, "','dd/MM/yyyy')  \r\n        --AND CAST(tpm.date_challan as DATE) <= to_date('31/01/ 2021','dd/MM/yyyy') and tpm.organization_id=1  \r\n        and tpd.vds_amount!=0 and tpd.is_source_tax_deduct=true");
            return this.DBUtil.GetDataTable(str);
        }

        public DataTable RebateInfo(string fromDate, string toDate)
        {
            string str = HttpContext.Current.Session["ORGANIZATION_ID"].ToString();
            string[] strArrays = new string[] { "select coalesce(sum(tpd.purchase_vat),0) totalVAT                       \r\n                         from trns_purchase_master as tpm\r\n                         inner join trns_purchase_detail as tpd on tpd.Challan_id=tpm.Challan_id \r\n                         WHERE  CAST(tpm.date_challan as DATE) >= to_date('", fromDate, "','dd/MM/yyyy') \r\n        AND CAST(tpm.date_challan as DATE) <= to_date('", toDate, "','dd/MM/yyyy') and tpm.organization_id=", str, " and tpd.is_rebatable=true" };
            string str1 = string.Concat(strArrays);
            return this.DBUtil.GetDataTable(str1);
        }

        public DataTable SaleInfo(string fromDate, string toDate)
        {
            string str = HttpContext.Current.Session["ORGANIZATION_ID"].ToString();
            string[] strArrays = new string[] { " select coalesce(sum(tsd.quantity*tsd.actual_price),0) totalPrice,coalesce(sum(tsd.vat),0) totalVAT                          \r\n                         from trns_sale_master as tsm\r\n                         inner join trns_sale_detail as tsd on tsd.Challan_id=tsm.Challan_id \r\n                         WHERE CAST(tsm.date_challan as DATE) >= to_date('", fromDate, "','dd/MM/yyyy') \r\n        AND CAST(tsm.date_challan as DATE) <= to_date('", toDate, "','dd/MM/yyyy') and tsm.organization_id=", str, " " };
            string str1 = string.Concat(strArrays);
            return this.DBUtil.GetDataTable(str1);
        }

        public DataTable SaleVATInfo(string fromDate, string toDate)
        {
            string str = HttpContext.Current.Session["ORGANIZATION_ID"].ToString();
            string[] strArrays = new string[] { "select coalesce(sum(tpd.vat),0) totalVAT                       \r\n                         from trns_sale_master as tpm\r\n                         inner join trns_sale_detail as tpd on tpd.Challan_id=tpm.Challan_id \r\n                         WHERE  CAST(tpm.date_challan as DATE) >= to_date('", fromDate, "','dd/MM/yyyy') \r\n        AND CAST(tpm.date_challan as DATE) <= to_date('", toDate, "','dd/MM/yyyy') and tpm.organization_id=", str, " and  tpd.is_source_tax_deduct=false" };
            string str1 = string.Concat(strArrays);
            return this.DBUtil.GetDataTable(str1);
        }

        public DataTable SaleVDSInfo(string fromDate, string toDate)
        {
            string str = HttpContext.Current.Session["ORGANIZATION_ID"].ToString();
            string[] strArrays = new string[] { "select coalesce(sum(tpd.vat),0) totalVAT                       \r\n                         from trns_sale_master as tpm\r\n                         inner join trns_sale_detail as tpd on tpd.Challan_id=tpm.Challan_id \r\n                         WHERE  CAST(tpm.date_challan as DATE) >= to_date('", fromDate, "','dd/MM/yyyy') \r\n        AND CAST(tpm.date_challan as DATE) <= to_date('", toDate, "','dd/MM/yyyy') and tpm.organization_id=", str, " and tpd.is_source_tax_deduct=true" };
            string str1 = string.Concat(strArrays);
            return this.DBUtil.GetDataTable(str1);
        }

        public DataTable Treasurychallan()
        {
            string str = HttpContext.Current.Session["ORGANIZATION_ID"].ToString();
            string str1 = string.Concat(" select sm.challan_no,i.item_name,TO_CHAR(sm.date_challan,'dd/MM/yyyy') date_challan,tp.party_name,case when sd.vds_amount = 0 then sd.purchase_vat else sd.vds_amount end  vds_amount                        \r\n                         from trns_purchase_master as sm\r\n                         inner join trns_purchase_detail as Sd on Sd.Challan_id=sm.Challan_id  \r\n                         inner join item as i on i.item_id = sd.item_id    \r\n                         inner join trns_party tp  on tp.party_id = sm.party_id                   \r\n                         WHERE Sd.is_source_tax_deduct = true and sm.organization_id=", str, "\r\n                         group by tp.party_name,sd.purchase_vat,sd.vds_amount,sm.Challan_no,sm.Is_deleted,is_vat_paid,i.item_name,sm.date_challan\r\n                         having sum(Sd.purchase_vat)>0\r\n                         and sm.Is_deleted=false");
            return this.DBUtil.GetDataTable(str1);
        }

        public DataTable TreasurychallanExpired()
        {
            DateTime dateTime = DateTime.Today.AddDays(-15);
            string str = dateTime.ToString("dd/MM/yyyy");
            string str1 = HttpContext.Current.Session["ORGANIZATION_ID"].ToString();
            string[] strArrays = new string[] { " select sm.challan_no,i.item_name,TO_CHAR(sm.date_challan,'dd/MM/yyyy') date_challan,tp.party_name,case when sd.vds_amount = 0 then sd.purchase_vat else sd.vds_amount end  vds_amount                        \r\n                         from trns_purchase_master as sm\r\n                         inner join trns_purchase_detail as Sd on Sd.Challan_id=sm.Challan_id  \r\n                         inner join item as i on i.item_id = sd.item_id    \r\n                         inner join trns_party tp  on tp.party_id = sm.party_id \r\n                         inner join credit_transac_history cth on sm.challan_id=cth.challan_id                      \r\n                         WHERE sm.is_payment_finished=true and Sd.is_source_tax_deduct = true and sm.organization_id=", str1, "\r\n                         group by tp.party_name,sd.purchase_vat,sd.vds_amount,sm.Challan_no,sm.Is_deleted,is_vat_paid,i.item_name,sm.date_challan\r\n                         having sum(Sd.purchase_vat)>0 and TO_DATE(max(TO_CHAR(cth.payment_date,'dd/MM/yyyy')),'dd/MM/yyyy')<TO_DATE('", str, "','dd/MM/yyyy')\r\n                         and sm.Is_deleted=false and is_vat_paid=false" };
            string str2 = string.Concat(strArrays);
            return this.DBUtil.GetDataTable(str2);
        }

        public DataTable TreasurychallanExpireToday()
        {
            DateTime dateTime = DateTime.Today.AddDays(-15);
            string str = dateTime.ToString("dd/MM/yyyy");
            string str1 = HttpContext.Current.Session["ORGANIZATION_ID"].ToString();
            string[] strArrays = new string[] { " select sm.challan_no,i.item_name,TO_CHAR(sm.date_challan,'dd/MM/yyyy') date_challan,tp.party_name,case when sd.vds_amount = 0 then sd.purchase_vat else sd.vds_amount end  vds_amount                        \r\n                         from trns_purchase_master as sm\r\n                         inner join trns_purchase_detail as Sd on Sd.Challan_id=sm.Challan_id  \r\n                         inner join item as i on i.item_id = sd.item_id    \r\n                         inner join trns_party tp  on tp.party_id = sm.party_id \r\n                         inner join credit_transac_history cth on sm.challan_id=cth.challan_id                      \r\n                         WHERE sm.is_payment_finished=true and Sd.is_source_tax_deduct = true and sm.organization_id=", str1, "\r\n                         group by tp.party_name,sd.purchase_vat,sd.vds_amount,sm.Challan_no,sm.Is_deleted,is_vat_paid,i.item_name,sm.date_challan\r\n                         having sum(Sd.purchase_vat)>0 and TO_DATE(max(TO_CHAR(cth.payment_date,'dd/MM/yyyy')),'dd/MM/yyyy')=TO_DATE('", str, "','dd/MM/yyyy')\r\n                         and sm.Is_deleted=false and is_vat_paid=false" };
            string str2 = string.Concat(strArrays);
            return this.DBUtil.GetDataTable(str2);
        }

        public DataTable TreasurychallanwithoutPayment()
        {
            string str = HttpContext.Current.Session["ORGANIZATION_ID"].ToString();
            string str1 = string.Concat(" select sm.challan_no,i.item_name,TO_CHAR(sm.date_challan,'dd/MM/yyyy') date_challan ,tp.party_name,case when sd.vds_amount = 0 then sd.purchase_vat else sd.vds_amount end  vds_amount                            \r\n                         from trns_purchase_master as sm\r\n                         join trns_purchase_detail as Sd on Sd.Challan_id=sm.Challan_id \r\n                         inner join item as i on i.item_id = sd.item_id  \r\n                         inner join trns_party tp  on tp.party_id = sm.party_id                         \r\n                         WHERE sm.is_payment_finished=true and Sd.is_source_tax_deduct = true and sm.organization_id=", str, "\r\n                         group by tp.party_name,sd.purchase_vat,sd.vds_amount,sm.Challan_no,sm.Is_deleted,is_vat_paid,i.item_name,sm.date_challan\r\n                         having sum(Sd.purchase_vat)>0\r\n                         and sm.Is_deleted=false and is_vat_paid=false");
            return this.DBUtil.GetDataTable(str1);
        }

        public DataTable TreasurychallanwithPayment()
        {
            string str = HttpContext.Current.Session["ORGANIZATION_ID"].ToString();
            string str1 = string.Concat(" select sm.challan_no,i.item_name,TO_CHAR(sm.date_challan,'dd/MM/yyyy') date_challan,tp.party_name,case when sd.vds_amount = 0 then sd.purchase_vat else sd.vds_amount end  vds_amount                        \r\n                         from trns_purchase_master as sm\r\n                         inner join trns_purchase_detail as Sd on Sd.Challan_id=sm.Challan_id  \r\n                         inner join item as i on i.item_id = sd.item_id    \r\n                         inner join trns_party tp  on tp.party_id = sm.party_id                   \r\n                         WHERE sm.is_payment_finished=true and Sd.is_source_tax_deduct = true and sm.organization_id=", str, "\r\n                         group by tp.party_name,sd.purchase_vat,sd.vds_amount,sm.Challan_no,sm.Is_deleted,is_vat_paid,i.item_name,sm.date_challan\r\n                         having sum(Sd.purchase_vat)>0\r\n                         and sm.Is_deleted=false and is_vat_paid=true");
            return this.DBUtil.GetDataTable(str1);
        }
    }
}